// Ionic Starter App
(function() {
    'use strict';

    angular.module('app', [
        'ionic',
        'ngCordova',
        'ngResource',

        "ui.bootstrap.tpls",
        "ui.bootstrap.datepicker"
    ])

    .run([

        '$ionicPlatform', '$rootScope', '$stateParams', '$state', 'AuthService', '$templateCache',

        function($ionicPlatform, $rootScope, $stateParams, $state, AuthService, $templateCache) {




            $templateCache.put('state/announcements/announcements.html', '<ion-view id="announcements"\n    cache-view="true"\n    can-swipe-back="false"\n    hide-nav-bar="false"\n>\n    <ion-nav-view name="announcements">\n    </ion-nav-view>\n\n    <ion-footer-bar class="bar-positive row footer">\n        <div class="col"\n            touch\n            ng-click="Announcements.goToEventListHandler()"\n        >\n            <span>이벤트</span>\n        </div>\n        <div class="col"\n            touch\n            ng-click="Announcements.goToNoticeListHandler()"\n        >\n            <span>공지사항</span>\n        </div>\n    </ion-footer-bar>\n</ion-view>\n');

            $templateCache.put('state/balance/balance.html', '<ion-view id="balance">\n    <ion-nav-view\n        name="balance"\n    >\n    </ion-nav-view>\n</ion-view>\n');

            $templateCache.put('state/cancel/cancel.html', '<ion-view view-title="예약취소" id="cancel">\n    <ion-content>\n        <ul class="list">\n            <li class="row row-list auto radius-bottom radius-top shadow zero"\n                ng-repeat="booking in Cancel.Model.current.bookings"\n                ng-if="Cancel.isNotCancelled(booking);"\n            >\n                <div class="c1 col-70 row wrap">\n                    <div class="col-100 shop-name">\n                        <span>{{booking.place.name}}</span>\n                    </div>\n\n                    <div class="col-30">\n                        <span>날짜</span>\n                    </div>\n                    <div class="col-70">\n                        <span>{{booking.datetime | date: \'yyyy.MM.dd\'}}</span>\n                    </div>\n\n                    <div class="col-30">\n                        <span>시간</span>\n                    </div>\n                    <div class="col-70">\n                        <span>{{booking.datetime | date: \'HH:mm\'}}</span>\n                    </div>\n\n                    <div class="col-30">\n                        <span>예약정보</span>\n                    </div>\n                    <div class="col-70">\n                        <span>{{booking.procuts[0].product.name}}</span>\n                    </div>\n\n                </div>\n                <div class="c2 col-30 zero radius-right"\n                    ng-click="Cancel.cancelHandler(booking.id, $index);"\n                >\n                    <span>\n                        예약취소\n                    </span>\n                </div>\n            </li>\n        </ul>\n    </ion-content>\n</ion-view>\n');

            $templateCache.put('state/daumMap/daumMap.html', '<ion-view id="daum-map"\n    view-title="전체보기"\n    cache-view="true"\n    can-swipe-back="false"\n    hide-back-button="true"\n    hide-nav-bar="false"\n>\n    <ion-nav-buttons side="left">\n        <button class="button button-icon icon ion-android-arrow-back"\n            ng-click="Map.goToHandler(\'main.home\')"\n        >\n        </button>\n    </ion-nav-buttons>\n\n    <ion-nav-buttons side="right">\n        <button class="button button-icon icon ion-pinpoint"\n            ng-click="Map.findMeThenSearchNearBy()"\n        >\n        </button>\n    </ion-nav-buttons>\n\n    <ion-header-bar class="bar-subheader zero">\n        <div class="r1 row row-search flex zero">\n            <div class="c1 col-82 zero">\n                <input id="daum-map-search-input" type="text"\n                    placeholder="상호명, 지역, 지하철 역을 검색하세요."\n                    ng-model="Map.search"\n                >\n            </div>\n            <div class="c2 col-10 flex"\n                touch\n                ng-click="Map.searchLocationNearBy(Map.search);"\n            >\n                <i class="ion-search"></i>\n            </div>\n        </div>\n    </ion-header-bar>\n\n    <ion-content class="has-subheader"\n        data-tap-disable="true"\n        scroll="false"\n    >\n        <div class="r2 row row-daum-map zero">\n            <div class="c1 col zero">\n                <div daum-map\n                    marker-src="img/800/icon/icon_map_s.png"\n                    marker-clicked-src="img/800/icon/icon_map_s.png"\n                    marker-width="30"\n                    marker-height="43"\n                ></div>\n            </div>\n        </div>\n\n    </ion-content>\n\n</ion-view>\n');

            $templateCache.put('state/daumMap/placeModal.html', '<ion-modal-view id="daum-map-modal">\n    <ion-content class="daum-map-modal-content">\n        <div class="daum-map-modal-container">\n\n            <div class="r1 row row-title zero"\n                touch\n                ng-click="Map.Model.modal.hide()"\n            >\n                <div class="c1 col-90 flex">\n                    <p>\n                        {{ Map.Model.selectedPlace.name }}\n                    </p>\n                </div>\n                <div class="c2 col flex"\n                >\n                    <i class="icon ion-ios-close-empty"></i>\n                </div>\n            </div>\n            <div class="r2 row row-content zero radius-bottom relative"\n                touch\n                ng-click="Map.goToDetailHandler()"\n            >\n                <div class="c1 col zero radius-bottom">\n                    <img class="radius-bottom"\n                        ng-src="{{ Map.Model.selectedPlace.photos[0].url }}"\n                    >\n\n                    <div class="description absolute radius-bottom">\n                        <div class="row row-description flex-v zero radius-bottom">\n                            <div class="c1 col-14 flex">\n                                <img src="img/800/icon/icon_map_s.png" alt="Nail Icon">\n                            </div>\n                            <div class="c2 col-54">\n                                <span>{{ Map.Model.selectedPlace.address }}</span>\n                            </div>\n                            <div class="c3 col flex">\n                                <i class="more-icon"></i>\n                            </div>\n                        </div>\n                    </div>\n\n                </div>\n            </div>\n        </div>\n    </ion-content>\n</ion-modal-view>\n');

            $templateCache.put('state/detail/detail.html', '<ion-view id="detail"\n    cache-view="false"\n    can-swipe-back="false"\n    hide-back-button="false"\n>\n<!-- <ion-nav-buttons side="left">\n    <button class="button button-icon icon ion-android-arrow-back"\n        ng-click="Detail.goBackHandler();"\n    >\n    </button>\n</ion-nav-buttons>\n -->\n <ion-nav-title>\n    {{Detail.Model.current.name}}\n</ion-nav-title>\n<ion-nav-buttons side="right">\n    <button class="button button-icon icon ion-heart"\n        ng-click="Detail.toggleSavePlace()"\n        ng-class="{\'favorite-place\': Detail.isFavorite()}"\n    >\n    </button>\n</ion-nav-buttons>\n\n\n    <!-- List Detail Content -->\n    <ion-content class="has-header">\n\n        <ion-slide-box class="non-row-slide-box" show-pager="true">\n            <ion-slide class="row-slides zero"\n                ng-repeat="photo in Detail.interiorPhotos"\n            >\n                <img class="place-image"\n                    ng-src="{{photo.url}}"\n                >\n            </ion-slide>\n        </ion-slide-box>\n        <div></div>\n\n        <!-- 상세정보 -->\n        <div class="row row-title-bar">\n            <div class="c1 col">\n                <h3>상세정보</h3>\n            </div>\n        </div>\n        <div class="detail-container auto">\n            <div class="row">\n                <div class="col-21 col-title">\n                    <p class="zero">이용시간</p>\n                    <p class="zero">전화번호</p>\n                    <p class="zero">주소</p>\n                    <p class="zero">가격정보</p>\n                </div>\n                <div class="col-79 col-text">\n                    <p class="zero">TODO: 10:00 ~ 21:00</p>\n                    <p class="zero">{{Detail.Model.current.phone}}</p>\n                    <p class="zero text-overflow">{{Detail.Model.current.address}}</p>\n                    <ul class="product-list">\n                        <li class="product-item"\n                            ng-repeat="product in Detail.Model.current.products | orderBy:\'price\'"\n                        >\n                            {{product.name}} - {{product.price}}\n                        </li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n\n\n        <!-- 포트폴리오 -->\n        <div class="row row-title-bar zero flex">\n            <div class="c1 col zero">\n                <h3 class="zero">포트폴리오</h3>\n            </div>\n        </div>\n        <ion-scroll class="portfolio-scroll"\n            zooming="false"\n            direction="x"\n            parent-scroll\n        >\n            <div class="portfolio-inner-scroll row zero"\n            >\n                <div class="col inner-scroll-item zero"\n                    ng-repeat="portfolioPhoto in Detail.portFolioPhotos"\n                >\n                    <img ng-src="{{portfolioPhoto.url}}">\n                </div>\n            </div>\n        </ion-scroll>\n\n\n        <!-- 예약현황 -->\n        <div class="row row-title-bar row-reserve-title">\n            <div class="col">\n                <h3>원하는 날짜를 선택해주세요.</h3>\n            </div>\n        </div>\n\n        <!-- {{Detail.Model.test}} -->\n        <div class="date-picker-container">\n            <datepicker class="date-picker"\n                ng-model="Detail.date"\n                show-weeks="false"\n                custom-class="Detail.dateStyler(date, mode)"\n            >\n            </datepicker>\n        </div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    </ion-content>\n\n</ion-view>\n');

            $templateCache.put('state/favorite/favorite.html', '<ion-view view-title="즐겨찾는 shop" id="favorite">\n    <ion-content>\n        <ul class="list">\n            <li class="r1 shop-list row row-item auto radius-top radius-bottom shadow"\n                ng-repeat="place in Favorite.Model.placeList"\n                ng-click="Favorite.goToDetailHandler(place)"\n            >\n                <div class="c1 col-25 place-image flex">\n                    <img ng-src="{{place.photos[0].url}}">\n                </div>\n                <div class="c2 col-75 row wrap zero">\n                    <div class="col-100 place-name">\n                        <span>{{place.name}}</span>\n                    </div>\n                    <div class="col-100 row detail">\n                        <div class="col-10">\n                            <i class="place-icon"></i>\n                        </div>\n                        <div class="col-60 place-address">\n                            <span>{{place.address}}</span>\n                        </div>\n                        <div class="col-30">\n                            <i class="detail-icon"></i>\n                        </div>\n                    </div>\n                </div>\n\n            </li>\n        </ul>\n    </ion-content>\n</ion-view>\n');

            $templateCache.put('state/list/list.html', '<ion-view id="list"\n    view-title="즐겨찾는 shop"\n    cache-view="true"\n    can-swipe-back="false"\n    hide-back-button="true"\n    hide-nav-bar="false"\n>\n    <!-- Set navigation header -->\n    <ion-nav-buttons side="left">\n        <button class="button button-icon icon ion-navicon"\n            ng-click="Main.toggleSideMenu()"\n        >\n        </button>\n    </ion-nav-buttons>\n    <ion-nav-buttons side="right">\n        <button class="button button-icon icon ion-android-share-alt">\n        </button>\n    </ion-nav-buttons>\n\n    <!-- List Content -->\n    <ion-content class="has-header">\n        <ion-refresher\n            pulling-text="새로운 내용이 있는지 보시려면 힘것 당기세요."\n            on-refresh="List.doRefresh()"\n            on-pulling=""\n            pulling-icon="ion-android-arrow-down"\n            disable-pulling-rotation="false"\n        >\n        </ion-refresher>\n\n        <div class="r1 row">\n            <div class="c1 col">\n                <h2>This is a list headline</h2>\n            </div>\n        </div>\n\n        <ion-list>\n            <ion-item class="r2 row-items row flex"\n                collection-repeat="item in List.lists"\n                item-width="100%"\n                item-height="vw * 0.30"\n                item-render-buffer="3"\n                force-refresh-images="false"\n                ng-click="List.itemHandler(item)"\n            >\n                <div class="c1 col">\n                    <span >\n                        {{item.title}}\n                    </span>\n                </div>\n            </ion-item>\n        </ion-list>\n        <!-- Checked immediately as soon as page is entered. -->\n        <ion-infinite-scroll\n            on-infinite="List.getData()"\n            distance="1%"\n            spinner="true"\n            immediate-check="true"\n            ng-if="List.checkForMore()"\n        >\n        </ion-infinite-scroll>\n\n    </ion-content>\n\n</ion-view>\n');

            $templateCache.put('state/login/login.html', '<ion-view id="login">\n    <ion-content class="no-header bg">\n        <div class="row r1 flex">\n            <div class="c1 col-57"\n                touch\n            >\n                <i class="facebook-button"></i>\n            </div>\n        </div>\n        <div class="row r2 flex">\n            <div class="c1 col-57"\n                touch\n            >\n                <i class="kakao-button"></i>\n            </div>\n        </div>\n    </ion-content>\n</ion-view>');

            $templateCache.put('state/main/main.html', '<ion-view id="main">\n    <ion-side-menus>\n        <ion-side-menu-content\n            edge-drag-threshold="false"\n            drag-content="false"\n        >\n        <!-- Main View -->\n            <ion-nav-bar class="bar-positive"\n                align-title="center"\n                no-tap-scroll="true"\n                delegate-handle="main"\n            >\n                <ion-nav-back-button>\n                </ion-nav-back-button>\n            </ion-nav-bar>\n\n            <ion-nav-view name="main">\n            </ion-nav-view>\n\n        </ion-side-menu-content>\n\n        <!-- Side Menu -->\n        <ion-side-menu side="left" class="side-menu-container">\n            <ion-content class="side-menu-content">\n                <ul>\n\n                    <!-- Row 1 -->\n                    <li class="r1 row row-header flex">\n                        <div class="col-30">\n                            <img class="picture"\n                                ng-src="{{Main.user.picture}}"\n                            >\n                        </div>\n                        <div class="col-70">\n                            <span class="username">\n                                {{ Main.user.name }} 님\n                            </span>\n                        </div>\n                    </li>\n\n                    <!-- Side Menu list -->\n                    <li class="r2 row row-menu-list flex-v zero"\n                        ng-repeat="item in Main.Model.sideMenuLists"\n                        ng-class="\n                            {\'selected\':\n                                Main.getCurrentState() === item.state\n                            }\n                        "\n                        ng-click="Main.menuSelectHandler(item)"\n                    >\n                        <div class="col-85 col-list-text zero">\n                            <p> {{ item.text }} </p>\n                        </div>\n                        <div class="col-10 col-icon">\n                            <i class="ion-ios-arrow-right"></i>\n                        </div>\n                    </li>\n                </ul>\n\n                <div class="row row-menu-list flex-v row-setting zero"\n                    ng-click="Main.toggleAccordion();"\n                >\n                    <div class="col-85 col-list-text zero">\n                        <p>설정</p>\n                    </div>\n                    <div class="col-10 col-icon zero">\n                        <i class="ion-ios-arrow-right"></i>\n                    </div>\n\n                </div>\n                    <div class="accordion"\n                        ng-show="Main.settingSubMenu === true"\n                    >\n\n                        <div class="row row-menu-list row-accordion flex-v zero"\n                            ng-click="Main.toggleSettingHandler(\'location\')"\n                            ng-class="{\'activate\': Main.Model.setting.location === \'on\'}"\n                        >\n                            <div class="col-30 col-list-text">\n                                <p>위치설정</p>\n                            </div>\n                            <div class="col-20">\n                                <i class="ion-android-locate"></i>\n                            </div>\n\n                        </div>\n\n                        <div class="row row-menu-list flex-v zero"\n                            ng-click="Main.toggleSettingHandler(\'push\')"\n                            ng-class="{\'activate\': Main.Model.setting.push === \'on\'}"\n                        >\n                            <div class="col-30 col-list-text">\n                                <p>푸쉬알람</p>\n                            </div>\n                            <div class="col-20">\n                                <i class="ion-ios-bell-outline"></i>\n                            </div>\n\n                        </div>\n\n                    </div>\n            </ion-content>\n\n            <ion-footer-bar class="side-menu-footer flex" touch>\n                <i class="side-menu-footer-icon"></i>\n            </ion-footer-bar>\n\n        </ion-side-menu>\n\n    </ion-side-menus>\n\n\n\n</ion-view>\n');

            $templateCache.put('state/mainHome/mainHome.html', '<ion-view id="main-home"\n    view-title="오늘 Nail"\n    cache-view="true"\n    can-swipe-back="false"\n    hide-back-button="true"\n    hide-nav-bar="false"\n>\n    <!-- Set navigation header -->\n    <ion-nav-buttons side="left">\n        <button class="button button-icon icon ion-navicon-round"\n            ng-click="Main.toggleSideMenu()"\n        >\n        </button>\n    </ion-nav-buttons>\n    <ion-nav-buttons side="right">\n        <button class="button button-icon icon ion-android-share-alt">\n        </button>\n    </ion-nav-buttons>\n\n\n\n    <!-- Home Content -->\n    <ion-content class="has-header">\n\n        <!-- ROw 1 -->\n        <div class="r1 row zero">\n            <div class="c1 col zero">\n            </div>\n        </div>\n\n\n        <!-- Row 2 -->\n        <!-- APP SPECIFIC -->\n        <div class="row row-search flex zero"\n            ng-click="Home.searchHandler()"\n        >\n            <div class="c1 col-82 zero">\n                <input type="text"\n                    placeholder="상호명, 지역, 지하철 역을 검색하세요."\n                    style="pointer-events:none;"\n                    ng-model="Map.search"\n                >\n            </div>\n            <div class="c2 col-10 flex"\n            >\n                <i class="ion-search"></i>\n            </div>\n        </div>\n\n        <!-- Row 3 -->\n        <div class="r3 row flex">\n            <div class="c1 col-32 overall"\n                touch\n                ng-click="Home.goToHandler(\'main.daumMap\')"\n            >\n                <i class="overall-icon"></i>\n            </div>\n            <div class="c2 col-32 favorite-shop"\n                touch\n                ng-click="Home.goToHandler(\'main.favorite\')"\n            >\n                <i class="heart-icon"></i>\n            </div>\n        </div>\n\n        <!-- Row 4 -->\n        <div class="r4 row flex">\n            <div class="c1 col-32 quick-service"\n                touch\n                ng-click="Home.goToHandler(\'main.daumMap\', {from:\'quick\'})"\n            >\n                <i class="quick-service-icon"></i>\n            </div>\n            <div class="c2 col-32 show-off"\n                touch\n                ng-click="Home.goToHandler(\'main.show.list\')"\n            >\n                <i class="show-off-icon"></i>\n            </div>\n        </div>\n    </ion-content>\n\n</ion-view>\n');

            $templateCache.put('state/schedule/reserveModal.html', '<ion-modal-view id="reserve-modal">\n    <ion-content class="reserve-modal-content">\n        <div class="content-wrapper relative">\n\n            <div class="row row-close zero">\n                <div class="col-15 col-x-icon zero flex"\n                    ng-click="Schedule.closeModalHandler()"\n                >\n                    <i class="ion-ios-close-empty"></i>\n                </div>\n            </div>\n\n            <div class="row row-service-container zero"\n                ng-repeat="product in Schedule.Model.current.products"\n                ng-click="Schedule.selectProductHandler(product)"\n                ng-class="{selected: Schedule.isSelectedProduct(product)}"\n            >\n                <div class="col-20 flex zero">\n                    <div class="circle">\n                    </div>\n                </div>\n                <div class="col-80 flex-v zero">\n                    <p>{{product.name}}</p>\n                </div>\n            </div>\n\n            <div class="row-name row flex-v">\n                <div class="col-20 col-name zero flex">\n                    <p class="zero">이름</p>\n                </div>\n                <div class="col-65 col-input zero">\n                    <input type="text" placeholder="이름을 입력해주세요."\n                        ng-model="Schedule.Model.form.userKoreanName"\n                    >\n                </div>\n            </div>\n\n            <div class="row-phone row">\n                <div class="col-20 col-phone zero flex">\n                    <p class="zero">연락처</p>\n                </div>\n                <div class="col-65 col-phone-input zero">\n                    <input type="number" placeholder="전화번호를 입력해주세요."\n                        ng-model="Schedule.Model.form.userPhoneNumber"\n                    >\n                </div>\n            </div>\n\n            <div class="row-foot-note flex">\n                <div class="col-wrapper">\n                    <p class="zero">* 원하시는 디자어너가 있으시면 유선 연락 바랍니다.</p>\n                    <p class="zero">* 예약취소는 \'설정\'을 이용해주세요.</p>\n                </div>\n            </div>\n\n            <div class="row-reserve row flex">\n\n               <div class="zero col-40 col-button flex"\n                    ng-click="Schedule.bookingHandler();"\n               >\n                   <p class="zero">\n                       예약\n                   </p>\n               </div>\n            </div>\n        </div>\n\n    </ion-content>\n</ion-modal-view>\n');

            $templateCache.put('state/schedule/schedule.html', '<ion-view id="schedule"\n    view-title="예약하기"\n    cache-view="false"\n    hide-back-button="false"\n>\n    <!-- List Content -->\n    <ion-content class="has-header">\n        <ul ng-if="Schedule.Model.viewSlots.length > 1 ">\n            <li class="r1 row-items row flex"\n                ng-repeat="reserveSlot in Schedule.Model.viewSlots track by $index"\n                ng-class="{selected: Schedule.isSelectedSlot(reserveSlot)}"\n                ng-click="Schedule.selectSlotHandler(reserveSlot, $index)"\n            >\n                <div class="c1 col zero">\n                    <span>\n                        {{ reserveSlot.format(\'HH:mm\')}}\n                    </span>\n                </div>\n                <div class="c2 col zero"\n                >\n                    <span class="not-available"\n                        ng-if="!Schedule.isAvailableSlot(reserveSlot)"\n                    >\n                        예약불가\n                    </span>\n                    <span class="available"\n                        ng-if="Schedule.isAvailableSlot(reserveSlot);"\n                    >\n                        예약가능\n                    </span>\n                </div>\n            </li>\n        </ul>\n        <h2 class="positive" ng-if="Schedule.Model.viewSlots.length <= 1">\n            오늘은 쉬는 날입니다\n        </h2>\n    </ion-content>\n\n</ion-view>\n');

            $templateCache.put('state/show/show.html', '<ion-view id="show"\n    view-title="자랑하기"\n    cache-view="true"\n    can-swipe-back="false"\n    hide-back-button="false"\n    hide-nav-bar="false"\n>\n    <ion-nav-view name="show">\n    </ion-nav-view>\n\n    <ion-footer-bar class="bar-positive row footer">\n        <div class="col"\n            touch\n            ng-click="Show.modalShowHandler()"\n        >\n            <span>새 글 쓰기</span>\n        </div>\n        <div class="col"\n            touch\n            ng-click="Show.goToSavedPostListHandler()"\n        >\n            <span>마이 갤러리</span>\n        </div>\n    </ion-footer-bar>\n</ion-view>\n');

            $templateCache.put('state/show/showModal.html', '<ion-modal-view id="show-modal">\n    <ion-content class="black-70">\n        <div class="row r1 flex row-90">\n            <div class="c1 col-80">\n                <span>새 글 쓰기</span>\n            </div>\n            <div class="c2 col-20"\n                ng-click="Show.modalHideHandler()"\n            >\n                <button class="button button-icon icon ion-ios-close-empty"></button>\n            </div>\n        </div>\n\n        <div class="row r2 row-90 flex">\n            <div class="c1 col-40 col"\n                ng-click="Show.getPictureHandler(1)"\n                touch\n            >\n                <span>사진찍기</span>\n            </div>\n            <div class="c2 col-40 col"\n                ng-click="Show.getPictureHandler(0)"\n                touch\n            >\n                <span>사진고르기</span>\n            </div>\n\n        </div>\n\n        <div class="row row-image flex">\n            <div class="col-90 zero">\n                <img class="camera-image" alt="no-img"\n                    ng-src="{{ Show.writeImageSrc }}"\n                    ng-if="Show.showWriteImage()"\n                >\n            </div>\n        </div>\n\n        <div class="row row-90 r3">\n            <div class="c1 col-20">\n                <span>제목</span>\n            </div>\n            <div class="c2 col-70">\n                <input type="text"\n                    ng-model="Show.writeTitle"\n                >\n            </div>\n        </div>\n\n        <div class="row r4 row-90">\n            <div class="c1 col">\n                <p class="label">내용</p>\n                <textarea\n                    ng-model="Show.writeContent"\n                ></textarea>\n            </div>\n        </div>\n\n        <div class="r5 row row-90 flex">\n            <div class="c1 col-90 col-button"\n                ng-click="Show.postHandler()"\n            >\n                <span>등록하기</span>\n            </div>\n        </div>\n    </ion-content>\n</ion-modal-view>\n');

            $templateCache.put('state/announcements/event/eventDetail.html', '<ion-view id="event-detail"\n    cache-view="false"\n    view-title="이벤트"\n    can-swipe-back="false"\n    hide-back-button="false"\n    hide-nav-bar="false"\n>\n    <!-- List Content -->\n    <ion-content class="has-header">\n\n        <div class="r1 row zero">\n            <div class="c1 col zero">\n                <h2 class="title">{{ EventDetail.Model.post.title }}</h2>\n            </div>\n        </div>\n\n        <div class="r2 row flex">\n            <div class="c1 col">\n                <img ng-src="{{EventDetail.Model.post.photos[0] &&  EventDetail.Model.post.photos[0].url}}">\n            </div>\n        </div>\n\n        <div class="r3 row">\n            <div class="c1 col">\n                <p> {{ EventDetail.Model.post.content }}</p>\n            </div>\n        </div>\n\n    </ion-content>\n</ion-view>\n');

            $templateCache.put('state/announcements/event/eventList.html', '<ion-view id="event-list"\n    view-title="이벤트"\n    cache-view="true"\n    can-swipe-back="false"\n    hide-back-button="true"\n    hide-nav-bar="false"\n>\n    <!-- Set navigation header -->\n    <ion-nav-buttons side="left">\n        <button class="button button-icon icon ion-navicon"\n            ng-click="Main.toggleSideMenu()"\n        >\n        </button>\n    </ion-nav-buttons>\n\n    <!-- List Content -->\n    <ion-content class="has-header">\n        <ion-refresher\n            pulling-text="새로운 내용이 있는지 보시려면 힘것 당기세요."\n            on-refresh="EventList.getNewerPosts()"\n            disable-pulling-rotation="false"\n        >\n        </ion-refresher>\n\n        <div class="r1 row no-post row-90 flex radius"\n            ng-if=""\n        >\n            <div class="c1 col">\n                <h2 class="title">오늘 nail 이벤트</h2>\n                <p class="message">진행중인 이벤트가 없습니다.</p>\n            </div>\n        </div>\n\n        <ion-list>\n            <ion-item class="r2 row-items row zero"\n                collection-repeat="post in EventList.Model.postsWrapper.posts"\n                item-width="95%"\n                item-height="vw * 0.30"\n                item-render-buffer="3"\n                force-refresh-images="false"\n                ng-click="EventList.goToDetailHandler(post)"\n                touch\n            >\n                <div class="c1 col-30 image zero flex">\n                    <img ng-src="{{post.photos[0] && post.photos[0].url}}">\n                </div>\n\n                <div class="c2 col-70 content">\n                    <h2 class="title">\n                        {{ post.title }}\n                    </h2>\n                    <p class="content">\n                        TODO:{{ post.summary }}\n                    </p>\n                </div>\n            </ion-item>\n        </ion-list>\n        <ion-infinite-scroll\n            on-infinite="EventList.getOlderPosts()"\n            distance="1%"\n            spinner="true"\n            immediate-check="false"\n            ng-if="EventList.checkForMore()"\n        >\n        </ion-infinite-scroll>\n\n    </ion-content>\n\n</ion-view>\n');

            $templateCache.put('state/announcements/notice/noticeDetail.html', '<ion-view id="notice-detail"\n    cache-view="false"\n    view-title="공지 사항"\n    can-swipe-back="false"\n    hide-back-button="false"\n    hide-nav-bar="false"\n>\n    <!-- List Content -->\n    <ion-content class="has-header">\n\n        <div class="r1 row">\n            <div class="c1 col">\n                <p> {{ NoticeDetail.Model.post.content }}</p>\n            </div>\n        </div>\n\n    </ion-content>\n</ion-view>\n');

            $templateCache.put('state/announcements/notice/noticeList.html', '<ion-view id="notice-list"\n    view-title="공지 사항"\n    cache-view="true"\n    can-swipe-back="false"\n    hide-back-button="false"\n    hide-nav-bar="false"\n>\n    <!-- List Content -->\n    <ion-content class="has-header">\n        <ion-refresher\n            pulling-text="새로운 내용이 있는지 보시려면 힘것 당기세요."\n            on-refresh="NoticeList.getNewerPosts()"\n        >\n        </ion-refresher>\n\n        <div class="r1 no-post row no-post row-90 flex radius"\n            ng-if=""\n        >\n            <div class="c1 col">\n                <h2 class="title">오늘 nail 공지사항</h2>\n                <p class="message">공지사항이 없습니다.</p>\n            </div>\n        </div>\n\n        <ion-list>\n            <ion-item class="r2 row-items row zero flex"\n                collection-repeat="post in NoticeList.Model.postsWrapper.posts"\n                item-width="100%"\n                item-height="vw * 0.16"\n                item-render-buffer="3"\n                force-refresh-images="false"\n                ng-click="NoticeList.goToDetailHandler(post)"\n                touch\n            >\n                <div class="c1 col-10 col image flex">\n                    <i class="notice-icon"></i>\n                </div>\n\n                <div class="c2 col-60 col content">\n                    <span class="col">{{post.title}}</span>\n                </div>\n\n                <div class="c3 col-30 col flex">\n                    <span class="time col">{{ post.createdAt | date : format : timezone }}</span>\n                </div>\n\n            </ion-item>\n        </ion-list>\n        <!-- Checked immediately as soon as page is entered. -->\n        <ion-infinite-scroll\n            on-infinite="NoticeList.getOlderPosts()"\n            distance="1%"\n            spinner="true"\n            immediate-check="false"\n            ng-if="NoticeList.checkForMore()"\n        >\n        </ion-infinite-scroll>\n\n    </ion-content>\n\n</ion-view>\n');

            $templateCache.put('state/balance/detail/balanceDetail.html', '<ion-view id="balance-detail" view-title="place.title">\n    <ion-content>\n        <div class="row r1 flex">\n            <div class="c1 col-40">\n                <i class="money-icon"></i>\n            </div>\n        </div>\n\n        <div class="row r2">\n            <div class="col c1">\n                <h3>place.title</h3>\n                <span class="name">user.username</span><span class="text">님의 남은 적립금</span>\n            </div>\n        </div>\n\n        <div class="row r3 radius-top radius-bottom flex auto">\n            <div class="col-90 c1">\n                <span>place.money</span>\n            </div>\n            <div class="col-10 c2">\n                <span>원</span>\n            </div>\n        </div>\n\n    </ion-content>\n</ion-view>\n');

            $templateCache.put('state/balance/list/balanceList.html', '<ion-view id="balance-list"\n    view-title="적립금 확인"\n>\n    <ion-content>\n        <ul class="list">\n            <li class="r1 shop-list row row-item auto radius-top radius-bottom shadow"\n                ng-repeat="place in BalanceList.places"\n            >\n                <div class="c1 col-25 place-image flex">\n                    <img src="http://placehold.it/100x100" alt="">\n                </div>\n                <div class="c2 col-75 row wrap zero">\n                    <div class="col-100 place-name">\n                        <span>{{ place.title }}</span>\n                    </div>\n                    <div class="col-100 row detail">\n                        <div class="col-10">\n                            <i class="place-icon"></i>\n                        </div>\n                        <div class="col-57 place-address">\n                            <span>{{ place.address }}</span>\n                        </div>\n                        <div class="col-33">\n                            <i class="coin-icon"></i>\n                        </div>\n                    </div>\n                </div>\n\n            </li>\n        </ul>\n    </ion-content>\n</ion-view>\n');

            $templateCache.put('state/show/detail/showDetail.html', '<ion-view id="show-detail"\n    view-title="네일 talk"\n    can-swipe-back="false"\n    hide-back-button="false"\n    hide-nav-bar="false"\n>\n    <!-- List Content -->\n    <ion-nav-buttons side="right">\n        <button class="button button-icon icon ion-ios-star-outline"\n            ng-click="ShowDetail.toggleSavePost()"\n            ng-class="{\'favorite-post\': ShowDetail.styleFavorite}"\n        >\n        </button>\n    </ion-nav-buttons>\n\n    <ion-content class="has-header">\n        <div class="r1 row zero">\n            <div class="c1 col zero">\n                <img ng-src="{{ShowDetail.Model.current.photos[0].url}}">\n            </div>\n        </div>\n        <div class="r2 row">\n            <div class="c1 col">\n                <h3 class="title">{{ShowDetail.Model.current.title}}</h3>\n                <p class="username">{{ShowDetail.Model.current.createdBy.username}}</p>\n                <div class="row counts zero">\n                    <div class="col-5 flex icon-container zero"\n                        toggle\n                    >\n                        <i class="icon ion-star"></i>\n                    </div>\n                    <div class="col-8 like-count count">\n                        <span> {{ ShowDetail.Model.current.likes }} </span>\n                    </div>\n                    <div class="col-5 flex icon-container">\n                        <i class="icon ion-ios-chatbubble"></i>\n                    </div>\n                    <div class="col-10 comment-count count">\n                        <span> {{ ShowDetail.Model.current.comments.length }} </span>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class="r3 row">\n            <div class="c1 col-70">\n                <textarea class="radius-bottom radius-top" type="text"\n                    ng-model="ShowDetail.comment"> </textarea>\n            </div>\n            <div class="c2 col-23 radius-bottom radius-top flex"\n                touch\n                ng-click="ShowDetail.addComment(ShowDetail.comment)"\n            >\n                <span class="col">Comment</span>\n            </div>\n        </div>\n\n        <div class="r4 row"\n            ng-repeat="comment in ShowDetail.Model.current.comments"\n        >\n            <div class="c1 col">\n                <h3 class="username">{{ comment.createdBy.nickname }}</h3>\n                <p class="comment">{{ comment.content }}</p>\n            </div>\n        </div>\n    </ion-content>\n</ion-view>\n');

            $templateCache.put('state/show/list/showList.html', '<ion-view id="show-list"\n    cache-view="true"\n    can-swipe-back="false"\n    hide-back-button="false"\n    hide-nav-bar="false"\n    view-title="네일 talk"\n>\n    <!-- List Content -->\n    <ion-content class="has-header">\n\n        <ion-refresher\n            pulling-text="새로운 내용이 있는지 보시려면 힘것 당기세요."\n            on-refresh="ShowList.getNewerPosts()"\n            disable-pulling-rotation="false"\n        >\n        </ion-refresher>\n\n        <ion-list class="r1 row-list row wrap zero">\n            <ion-item class="col items"\n                collection-repeat="post in ShowList.Model.postsWrapper.posts"\n                item-width="50%"\n                item-height="vw * 0.69"\n                item-render-buffer="3"\n                force-refresh-images="false"\n                ng-click="ShowList.goToDetailHandler(post)"\n                touch\n            >\n                    <img class="title-image" ng-src="{{ post.photos[0].url || \'http://placehold.it/500x500\'}}"\n                    >\n                    <p class="title">{{ post.title }}</p>\n                    <p class="user-id">{{ post.createdBy.username }}</p>\n                    <div class="row counts">\n                        <div class="col-10 flex icon-container"\n                            toggle\n                        >\n                            <i class="icon ion-star"></i>\n                        </div>\n                        <div class="col-20 like-count count">\n                            <span> {{post.likes}} </span>\n                        </div>\n                        <div class="col-10 flex icon-container">\n                            <i class="icon ion-ios-chatbubble"></i>\n                        </div>\n                        <div class="col-20 comment-count count">\n                            <span> {{ post.comments.length }} </span>\n                        </div>\n                    </div>\n\n            </ion-item>\n        </ion-list>\n        <!-- Checked immediately as soon as page is entered. -->\n        <ion-infinite-scroll\n            on-infinite="ShowList.getOlderPosts()"\n            distance="1%"\n            spinner="true"\n            immediate-check="false"\n            ng-if="ShowList.checkForMore()"\n        >\n        </ion-infinite-scroll>\n    </ion-content>\n</ion-view>\n');

            $templateCache.put('state/show/savedShow/savedShowList.html', '<!-- Saved show list -->\n<ion-view id="show-list"\n    cache-view="true"\n    can-swipe-back="false"\n    hide-back-button="false"\n    view-title="마이 갤러리"\n    hide-nav-bar="false"\n>\n    <!-- List Content -->\n    <ion-content class="has-header">\n\n        <ion-list class="r1 row-list row wrap zero">\n            <ion-item class="col items"\n                collection-repeat="post in SavedShowList.Model.posts"\n                item-width="50%"\n                item-height="vw * 0.69"\n                item-render-buffer="3"\n                force-refresh-images="false"\n                ng-click="SavedShowList.goToDetailHandler(post)"\n                touch\n            >\n                    <img class="title-image" ng-src="{{ post.photos[0] && post.photos[0].url }}"\n                    >\n                    <p class="title">{{ post.title }}</p>\n                    <p class="user-id">TODO:{{ post.createdBy.nickname }}</p>\n                    <div class="row counts">\n                        <div class="col-10 flex icon-container"\n                            toggle\n                        >\n                            <i class="icon ion-star"></i>\n                        </div>\n                        <div class="col-20 like-count count">\n                            <span> TODO:{{ post.likeCount }} </span>\n                        </div>\n                        <div class="col-10 flex icon-container">\n                            <i class="icon ion-ios-chatbubble"></i>\n                        </div>\n                        <div class="col-20 comment-count count">\n                            <span> TODO:{{ post.comments.length }} </span>\n                        </div>\n                    </div>\n\n            </ion-item>\n        </ion-list>\n    </ion-content>\n</ion-view>\n');









            $ionicPlatform.ready(function() {
                if (window.cordova && window.cordova.plugins.Keyboard) {
                    cordova.plugins.Keyboard.hideKeyboardAccessoryBar(true);
                }
                if (window.StatusBar) {
                    StatusBar.styleDefault();
                }
            });

            AuthService.login('admin', 'admin1234');

            $state.go('main.home');
        }
    ])

    .config([

        '$stateProvider', '$httpProvider',

        function($stateProvider, $httpProvider) {

            // Security handler
            $httpProvider.interceptors.push('AuthInterceptor');

            // Allow session
            // $httpProvider.defaults.withCredentials = true;

            $stateProvider

            .state('login', {
                url: '/login',
                templateUrl: 'state/login/login.html',
                controller: 'LoginController as Login'
            })

            .state('main', {
                url: '/main',
                templateUrl: 'state/main/main.html',
                controller: 'MainController as Main'
            })

            .state('main.home', {
                url: '/home',
                views: {
                    main: {
                        templateUrl: 'state/mainHome/mainHome.html',
                        controller: 'MainHomeController as Home'
                    }
                }
            })

            .state('main.list', {
                url: '/list',
                views: {
                    main: {
                        templateUrl: 'state/list/list.html',
                        controller: 'ListController as List'
                    }
                }
            })

            .state('main.daumMap', {
                url: '/daumMap/:from',
                views: {
                    main: {
                        templateUrl: 'state/daumMap/daumMap.html',
                        controller: 'DaumMapController as Map'
                    }
                }
            })

            .state('main.detail', {
                url: '/detail/:id',
                views: {
                    main: {
                        templateUrl: 'state/detail/detail.html',
                        controller: 'DetailController as Detail'
                    }
                }
            })

            .state('main.schedule', {
                url: '/schdule/:id/:selectedDate',
                views: {
                    main: {
                        templateUrl: 'state/schedule/schedule.html',
                        controller: 'ScheduleController as Schedule'
                    }
                }
            })

            .state('main.balance', {
                url: '/balance',
                abstract: true,
                views: {
                    main: {
                        templateUrl: 'state/balance/balance.html',
                        controller: 'BalanceController as Balance'
                    }
                }
            })
                .state('main.balance.list', {
                    url: '/list',
                    views: {
                        balance: {
                            templateUrl: 'state/balance/list/balanceList.html',
                            controller: 'BalanceListController as BalanceList'
                        }
                    }
                })
                .state('main.balance.detail', {
                    url: '/detail',
                    views: {
                        balance: {
                            templateUrl: 'state/balance/detail/balanceDetail.html',
                            controller: 'BalanceDetailController as BalanceDetail'
                        }
                    }
                })

            .state('main.cancel', {
                url: '/cancel',
                views: {
                    main: {
                        templateUrl: 'state/cancel/cancel.html',
                        controller: 'CancelController as Cancel'
                    }
                }
            })

            .state('main.favorite', {
                url: '/favorite',
                views: {
                    main: {
                        templateUrl: 'state/favorite/favorite.html',
                        controller: 'FavoriteController as Favorite'
                    }
                }
            })

            .state('main.show', {
                url: '/show',
                abstract: true,
                views: {
                    main: {
                        templateUrl: 'state/show/show.html',
                        controller: 'ShowController as Show'
                    }
                }
            })
                .state('main.show.list', {
                    url: '/list',
                    views: {
                        show: {
                            templateUrl: 'state/show/list/showList.html',
                            controller: 'ShowListController as ShowList'
                        }
                    }
                })
                .state('main.show.savedList', {
                    url: '/savedList',
                    views: {
                        show: {
                            templateUrl: 'state/show/savedShow/savedShowList.html',
                            controller: 'SavedShowListController as SavedShowList'
                        }
                    }
                })
                .state('main.show.detail', {
                    url: '/detail/:id',
                    views: {
                        show: {
                            templateUrl: 'state/show/detail/showDetail.html',
                            controller: 'ShowDetailController as ShowDetail'
                        }
                    }
                })

            .state('main.announcements', {
                abstract: true,
                url: '/announcements',
                views: {
                    main: {
                        templateUrl: 'state/announcements/announcements.html',
                        controller: 'AnnouncementsController as Announcements'
                    }
                }
            })
                .state('main.announcements.eventList', {
                    url: '/eventList',
                    views: {
                        announcements: {
                            templateUrl: 'state/announcements/event/eventList.html',
                            controller: 'EventListController as EventList'
                        }
                    }
                })
                .state('main.announcements.eventDetail', {
                    url: '/eventDetail/:id',
                    views: {
                        announcements: {
                            templateUrl: 'state/announcements/event/eventDetail.html',
                            controller: 'EventDetailController as EventDetail'
                        }
                    }
                })
                .state('main.announcements.noticeList', {
                    url: '/noticeList',
                    views: {
                        announcements: {
                            templateUrl: 'state/announcements/notice/noticeList.html',
                            controller: 'NoticeListController as NoticeList'
                        }
                    }
                })
                .state('main.announcements.noticeDetail', {
                    url: '/noticeDetail/:id',
                    views: {
                        announcements: {
                            templateUrl: 'state/announcements/notice/noticeDetail.html',
                            controller: 'NoticeDetailController as NoticeDetail'
                        }
                    }
                })
        } //END
    ]);

})();

/**
 * Created by Andy on 6/6/2015
 * As part of myfitmate
 *
 * Copyright (C) Applicat (www.applicat.co.kr) & Andy Yoon Yong Shin - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Andy Yoon Yong Shin <andy.shin@applicat.co.kr>, 6/6/2015
 *
 */

/**
 * Created by Andy on 5/26/2015
 * As part of beijingtongclient
 *
 * Copyright (C) Applicat (www.applicat.co.kr) & Andy Yoon Yong Shin - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Andy Yoon Yong Shin <andy.shin@applicat.co.kr>, 5/26/2015
 *
 */


/*
 *
 * Constant app config
 *
 */


(function() {
    'use strict';

    angular.module('app')
        .constant("governorUrl", "http://192.168.0.65:1337")
        .constant("appName", "todayNail")
    // .constant("appId", 2)
    // .constant("googlePushSenderID", "350504486209")
    // .constant("kakaoKey", "bdb254de02ea0b7521635ba469608674")
    // .constant("facebookKey", "801820753200919")

})();

(function() {
    'use strict';

    angular.module('app')
        .factory('Bookings', Bookings);

    Bookings.$inject = ['$resource', 'governorUrl', '$cordovaFileTransfer'];

    function Bookings($resource, governorUrl, $cordovaFileTransfer) {

        var bookingUrl = governorUrl + '/booking' + '/:list' +
            '/:image' + '/:mine' + '/:dateBetween';

        var params = {
            list: '@list',
            image: '@image',
            mine: '@mine',
            dateBetween: '@dateBetween'
        };

        var actions = {
            getBookings: {
                method: 'GET',
                params: {
                    list: 'list'
                }
            },
            getMyBookings: {
                method: 'GET',
                params: {
                    list: 'list',
                    mine: 'mine'
                }
            },
            getBookingsDateBetween: {
                method: 'GET',
                params: {
                    dateBetween: 'dateBetween'
                }
            },

            findById: {
                method: 'GET'
            },
            createBooking: {
                method: 'POST'
            },
            updateBooking: {
                method: 'PUT'
            },
            removeBooking: {
                method: 'DELETE'
            }
        };

        var service = $resource(bookingUrl, params, actions);

        //------------------------
        //  CUSTOM NON-HTTP METHODS
        //------------------------
        service.createBookingWithImage = function(parameters, booking) {
            angular.extend(booking, parameters);
            var filePath = booking.file;
            delete booking.file;
            var options = {
                params: booking,
                chunkedMode: false
            };
            return {
                '$promise': $cordovaFileTransfer.upload(governorUrl + '/booking/image', filePath, options)
            };
        };

        service.updateBookingWithImage = function(parameters, booking) {
            angular.extend(booking, parameters);
            var filePath = booking.file;
            delete booking.file;
            var options = {
                params: booking,
                chunkedMode: false,
                httpMethod: 'PUT'
            };
            return {
                '$promise': $cordovaFileTransfer.upload(governorUrl + '/booking/image', filePath, options)
            };

        }

        return service;
    }

    // Booking.get({
    //     list: 'list',
    //     category: 'SHOW-POST'
    // }).$promise
    //     .then(function success() {}, function err() {})

    // Bookings.createBookingWithImage({}, bookingWithFile).$promise
    //     .then(function success() {}, function error() {}, function progress(progress) {})

    // require id in bookingWithFile sails' req.param('id') not only look at url params but
    //also looks at the body of req, it is a sails spcific feature.
    // Bookings.createBookingWithImage({}, bookingWithFile).$promise
    //     .then(function success() {}, function error() {}, function progress(progress) {})

})();

(function() {
    'use strict';

    angular.module('app')
        .factory('Comments', Comments);

    Comments.$inject = ['$resource', 'governorUrl']

    function Comments($resource, governorUrl) {

        var commentUrl = governorUrl + '/post/comment';

        var params = {};

        var actions = {
            addCommentToPost: {
                method: 'POST'
            }
        };

        var service = $resource(commentUrl, params, actions)

        return service;
    }

})();

(function() {
    'use strict';

    angular.module('app')
        .factory('Places', Places)

    Places.$inject = ['$resource', 'governorUrl', '$cordovaFileTransfer'];

    function Places($resource, governorUrl, $cordovaFileTransfer) {

        var placeUrl = governorUrl + '/place' + '/:list' + '/:mine' +
            '/:within' + '/:image';

        var params = {
            list: '@list',
            mine: '@mine',
            within: '@within',
            image: '@image',
        };

        var actions = {
            getPlaces: {
                method: 'GET',
                params: {
                    list: 'list'
                }
            },
            getMyPlaces: {
                method: 'GET',
                params: {
                    list: 'list',
                    mine: 'mine'
                }
            },
            getPlacesWithin: {
                method: 'GET',
                params: {
                    list: 'list',
                    within: 'within'
                }
            },
            findById: {
                method: 'GET'
            },
            createPlace: {
                method: 'POST'
            },
            createPlaceWithImage: {
                method: 'POST',
                params: {
                    image: 'image'
                }
            },
            updatePlace: {
                method: 'PUT'
            },
            updatePlaceWithImage: {
                method: 'PUT',
                params: {
                    image: 'image'
                }
            },
            removePlace: {
                method: 'DELETE'
            }
        };

        var service = $resource(placeUrl, params, actions);

        //------------------------
        //  CUSTOM NON-HTTP METHODS
        //------------------------
        service.createPlaceWithImage = function(parameters, place) {
            angular.extend(place, parameters);
            var filePath = place.file;
            delete place.file;
            var options = {
                params: place,
                chunkedMode: false
            };
            return {
                '$promise': $cordovaFileTransfer.upload(governorUrl + '/place/image', filePath, options)
            };
        };

        service.updatePlaceWithImage = function(parameters, place) {
            angular.extend(place, parameters);
            var filePath = place.file;
            delete place.file;
            var options = {
                params: place,
                chunkedMode: false,
                httpMethod: 'PUT'
            };
            return {
                '$promise': $cordovaFileTransfer.upload(governorUrl + '/place/image', filePath, options)
            };

        }
        return service;
    }

})();

(function() {
    'use strict';
    angular.module('app')
        .factory('Posts', Posts);

    Posts.$inject = ['$resource', 'governorUrl', '$cordovaFileTransfer'];

    function Posts($resource, governorUrl, $cordovaFileTransfer) {

        var postUrl = governorUrl + '/post' + '/:list' +
            '/:image' + '/:mine' + '/:like';

        var params = {
            list: '@list',
            image: '@image',
            mine: '@mine',
            like: '@like'
        };

        var actions = {
            getPosts: {
                method: 'GET',
                params: {
                    list: 'list'
                }
            },
            getMyPosts: {
                method: 'GET',
                params: {
                    list: 'list',
                    mine: 'mine'
                }
            },
            findById: {
                method: 'GET'
            },
            createPost: {
                method: 'POST'
            },
            updatePost: {
                method: 'PUT'
            },
            likePost: {
                method: 'PUT',
                params: {
                    like: 'like'
                }
            },
            removePost: {
                method: 'DELETE'
            }
        };

        var service = $resource(postUrl, params, actions);

        //------------------------
        //  CUSTOM NON-HTTP METHODS
        //------------------------
        service.createPostWithImage = function(parameters, post) {
            angular.extend(post, parameters);
            var filePath = post.file ? post.file : '[]';
            delete post.file;
            var options = {
                params: post,
                chunkedMode: false
            };
            return {
                '$promise': $cordovaFileTransfer.upload(governorUrl + '/post', filePath, options)
            };
        };

        service.updatePostWithImage = function(parameters, post) {
            angular.extend(post, parameters);
            var filePath = post.file;
            delete post.file;
            var options = {
                params: post,
                chunkedMode: false,
                httpMethod: 'PUT'
            };
            return {
                '$promise': $cordovaFileTransfer.upload(governorUrl + '/post/image', filePath, options)
            };

        }

        return service;
    }

    // Post.get({
    //     list: 'list',
    //     category: 'SHOW-POST'
    // }).$promise
    //     .then(function success() {}, function err() {})

    // Posts.createPostWithImage({}, postWithFile).$promise
    //     .then(function success() {}, function error() {}, function progress(progress) {})

    // require id in postWithFile sails' req.param('id') not only look at url params but
    //also looks at the body of req, it is a sails spcific feature.
    // Posts.createPostWithImage({}, postWithFile).$promise
    //     .then(function success() {}, function error() {}, function progress(progress) {})


})();

(function() {
    'use strict';
    angular.module('app')
        .factory('Products', Products);

    Products.$inject = ['$resource', 'governorUrl', '$cordovaFileTransfer'];

    function Products($resource, governorUrl, $cordovaFileTransfer) {

        var productUrl = governorUrl + '/product' + '/:list' +
            '/:image' + '/:mine' + '/:checkProductCode';

        var params = {
            list: '@list',
            image: '@image',
            mine: '@mine',
            checkProductCode: '@checkProductCode'
        };

        var actions = {
            getProducts: {
                method: 'GET',
                params: {
                    list: 'list'
                }
            },
            getMyProducts: {
                method: 'GET',
                params: {
                    list: 'list',
                    mine: 'mine'
                }
            },
            checkProductCode: {
                method: 'GET',
                params: {
                    checkProductCode: 'checkProductCode'
                }
            },
            findById: {
                method: 'GET'
            },
            createProduct: {
                method: 'POST'
            },
            updateProduct: {
                method: 'PUT'
            },
            removeProduct: {
                method: 'DELETE'
            }
        };

        var service = $resource(productUrl, params, actions);

        //------------------------
        //  CUSTOM NON-HTTP METHODS
        //------------------------
        service.createProductWithImage = function(parameters, product) {
            angular.extend(product, parameters);
            var filePath = product.file;
            delete product.file;
            var options = {
                params: product,
                chunkedMode: false
            };
            return {
                '$promise': $cordovaFileTransfer.upload(governorUrl + '/product/image', filePath, options)
            };
        };

        service.updateProductWithImage = function(parameters, product) {
            angular.extend(product, parameters);
            var filePath = product.file;
            delete product.file;
            var options = {
                params: product,
                chunkedMode: false,
                httpMethod: 'PUT'
            };
            return {
                '$promise': $cordovaFileTransfer.upload(governorUrl + '/product/image', filePath, options)
            };

        }

        return service;
    }

    // Product.get({
    //     list: 'list',
    //     category: 'SHOW-POST'
    // }).$promise
    //     .then(function success() {}, function err() {})

    // Products.createProductWithImage({}, productWithFile).$promise
    //     .then(function success() {}, function error() {}, function progress(progress) {})

    // require id in productWithFile sails' req.param('id') not only look at url params but
    //also looks at the body of req, it is a sails spcific feature.
    // Products.createProductWithImage({}, productWithFile).$promise
    //     .then(function success() {}, function error() {}, function progress(progress) {})


})();

(function() {
    'use strict';

    angular.module('app')
        .factory('Users', Users);


    Users.$inject = ['$resource', 'governorUrl', '$cordovaFileTransfer'];

    function Users($resource, governorUrl, $cordovaFileTransfer) {

        var userUrl = governorUrl + '/user';

        var params = {};

        var actions = {};

        var service = $resource(userUrl, params, actions);

        return service;
    }

})();

(function() {
    'use strict';

    angular.module('app')
        .factory('AuthInterceptor', AuthInterceptor);

    AuthInterceptor.$inject = ['$q', '$injector', '$location', 'LocalService', 'appName'];

    function AuthInterceptor($q, $injector, $location, LocalService, appName) {

        return {
            request: function(config) {

                var token = LocalService.get(appName + '_auth_token');

                if (token) {
                    token = angular.fromJson(LocalService.get(appName + '_auth_token')).token;
                }

                if (token) {
                    config.headers.Authorization = 'Bearer ' + token;
                }
                return config;
            },
            responseError: function(response) {
                if (response.status === 401 || response.status === 403 || response.status === 405 || response.status === 498) {

                    if ($location.path() !== "/login") {

                        LocalService.unset(appName + '_auth_token');
                        $location.path("/login");

                        if (response.data == null || response.data == undefined) {
                            response.data = {
                                message: "권한이 없는 페이지이거나 로그인하지 않았습니다. 로그인해주세요."
                            };
                        }
                    } else {
                        response.data.hideMessage = true;
                    }
                } else if (response.status === 300) {

                    var redirectPath = null;
                    var message = '';
                    switch (response.data.redirectCode) {
                        case 'ACTIVATE':
                            redirectPath = "/resend/false";
                            message: "이메일 인증을 하셔야 서비스 이용이 가능합니다.";
                            break;
                        case 'RESET':
                            redirectPath = "/passReset";
                            message: "비밀번호를 봐꿔주세요.";
                            break;
                    }

                    if ($location.path() !== redirectPath) {

                        $location.path(redirectPath);

                        if (response.data == null || response.data == undefined) {
                            response.data = {
                                message: message
                            };
                        }
                    } else {
                        response.data.hideMessage = true;
                    }
                }
                return $q.reject(response);
            }
        }
    }


    angular.module('app')
        .service("AuthService", AuthService);

    AuthService.$inject = ['$http', '$q', '$location', '$state', 'governorUrl', 'LocalService', 'appName'];

    function AuthService($http, $q, $location, $state, governorUrl, LocalService, appName) {

        var user = null;
        var selectedApp = {
            name: '어플리켓'
        };

        function setUser(userInfo) {
            user = userInfo;
        }

        this.getUser = function() {
            return user;
        }

        function setApp(app) {
            $rootScope.appName = app.name;
            selectedApp = app;
        }

        this.getApp = function() {
            return selectedApp;
        }

        this.getToken = function() {
            var token = LocalService.get(appName + '_auth_token');

            if (token) {
                token = angular.fromJson(LocalService.get(appName + '_auth_token')).token;
                return token;
            } else {
                $state.go('login');
            }
        }

        this.init = function() {
            var token = JSON.parse(LocalService.get(appName + '_auth_token'));
            if (token != null && token.user != null)
                setUser(token.user);
        }

        this.register = function(user) {

            var deferred = $q.defer();

            $http({
                url: governorUrl + '/user/register',
                method: 'post',
                headers: {
                    'Content-Type': 'application/json'
                },
                params: user
            })
                .success(function(data, status, headers, config) {
                    deferred.resolve(data);
                })
                .error(function(data, status, headers, config) {
                    deferred.reject(data);
                });
            return deferred.promise;
        }

        this.registerWithImage = function(user, file, success, fail) {

            var options = new FileUploadOptions();

            var newUser = angular.copy(user);

            options.params = newUser;
            options.headers = {
                Connection: "close"
            }
            options.chunkedMode = false;

            var ft = new FileTransfer();

            ft.upload(file, encodeURI(governorUrl + '/user/registerWithImage'), success, fail, options, true);
        }

        this.login = function(email, password) {

            var deferred = $q.defer();

            $http({
                url: governorUrl + '/auth/local',
                method: 'post',
                headers: {
                    'Content-Type': 'application/json'
                },
                data: {
                    'identifier': email,
                    'password': password
                }
            })
                .success(function(data, status, headers, config) {

                    console.log(data);
                    LocalService.set(appName + '_auth_token', JSON.stringify(data));
                    setUser(data.user);

                    deferred.resolve(data);
                })
                .error(function(data, status, headers, config) {
                    console.log(data);
                    deferred.reject(data);
                });

            return deferred.promise;

        }

        this.verifyResetCode = function(email, code) {

            var deferred = $q.defer();


            $http({
                url: governorUrl + '/user/passwordresetcomplete',
                method: 'put',
                headers: {
                    'Content-Type': 'application/json'
                },
                data: {
                    'email': email,
                    'code': code
                }
            })
                .success(function(data, status, headers, config) {
                    LocalService.set(appName + '_auth_token', JSON.stringify(data));
                    deferred.resolve(data);
                })
                .error(function(data, status, headers, config) {
                    deferred.reject(data);
                });

            return deferred.promise;

        }

        this.passReset = function(email) {

            var deferred = $q.defer();

            $http({
                url: governorUrl + '/user/resetStart',
                method: 'post',
                headers: {
                    'Content-Type': 'application/json'
                },
                data: {
                    'email': email
                }
            })
                .success(function(data, status, headers, config) {
                    deferred.resolve(data);
                })
                .error(function(data, status, headers, config) {
                    deferred.reject(data);
                });
            return deferred.promise;
        }

        this.logout = function() {
            LocalService.unset(appName + '_auth_token');
            setUser(null);
            $location.path("/login");
        }

        this.changePassword = function(oldPassword, newPassword) {

            var deferred = $q.defer();

            $http({
                url: governorUrl + '/user/changePassword',
                method: 'post',
                headers: {
                    'Content-Type': 'application/json'
                },
                data: {
                    'oldPassword': oldPassword,
                    'newPassword': newPassword
                }
            })
                .success(function(data, status, headers, config) {
                    deferred.resolve(data);
                })
                .error(function(data, status, headers, config) {
                    deferred.reject(data);
                });

            return deferred.promise;
        }

        this.checkNickname = function(nickname) {

            var deferred = $q.defer();

            $http({
                url: governorUrl + '/user/checknickname',
                method: 'get',
                headers: {
                    'Content-Type': 'application/json'
                },
                params: {
                    nickname: nickname
                }
            })
                .success(function(data, status, headers, config) {
                    deferred.resolve(data);
                })
                .error(function(data, status, headers, config) {
                    deferred.reject(data);
                });
            return deferred.promise;
        }

        this.checkEmail = function(email) {

            var deferred = $q.defer();

            $http({
                url: governorUrl + '/user/checkEmail',
                method: 'get',
                headers: {
                    'Content-Type': 'application/json'
                },
                params: {
                    email: email
                }
            })
                .success(function(data, status, headers, config) {
                    deferred.resolve(data);
                })
                .error(function(data, status, headers, config) {
                    deferred.reject(data);
                });
            return deferred.promise;
        }

        this.getMyProfile = function() {
            var deferred = $q.defer();

            $http({
                url: governorUrl + '/user/profile',
                method: 'get',
                headers: {
                    'Content-Type': 'application/json'
                },
            })
                .success(function(data, status, headers, config) {
                    deferred.resolve(data);
                })
                .error(function(data, status, headers, config) {
                    deferred.reject(data);
                });
            return deferred.promise;
        }

        this.updateMyProfile = function(nickname) {
            var deferred = $q.defer();

            $http({
                url: governorUrl + '/user/update',
                method: 'put',
                headers: {
                    'Content-Type': 'application/json'
                },
                data: {
                    nickname: nickname
                }
            })
                .success(function(data, status, headers, config) {
                    deferred.resolve(data);
                })
                .error(function(data, status, headers, config) {
                    deferred.reject(data);
                });
            return deferred.promise;
        }

        this.updateMyProfileWithImage = function(user, file, success, fail) {

            var options = new FileUploadOptions();

            var updateUser = angular.copy(user);

            options.params = updateUser;
            options.httpMethod = 'PUT';
            options.headers = {
                Connection: "close",
                Authorization: 'Bearer ' + this.getToken()
            }
            options.chunkedMode = false;

            var ft = new FileTransfer();

            ft.upload(file, encodeURI(governorUrl + '/user/updateWithImage'), success, fail, options, true);
        }

    }


})();

(function() {
    'use strict';

    angular.module('app')
        .factory('Dom', Dom);

    Dom.$inject = ['$timeout', '$window'];

    function Dom($timeout, $window) {
        var service = {
            focusById: focusById
        };

        return service;

        // USAGE;
        // <input id="daum-map-search-input" type="text">
        // Dom.focusById('daum-map-search-input');
        function focusById(id) {
            $timeout(function() {
                var domElement = $window.document.getElementById(id);
                if (domElement) {
                    domElement.focus();
                }
            });
        }
    }

})();

// Dependencies;
// vm.styleFavorite
// model.current    // eg Detail.currentPost, Detail.currentPlace... rename to current
(function() {
    'use strict';

    angular.module('app')
        .factory('Favorite', Favorite);

    Favorite.$inject = ['$stateParams', 'Message', 'Posts'];

    function Favorite($stateParams, Message, Posts) {

        var service = {
            isFavorite: isFavorite,
            saveToFavorite: saveToFavorite
        };
        return service;

        //------------------------
        //  Implementations
        //------------------------
        function isFavorite(localStorageItem) {
            var favoritesString = localStorage.getItem(localStorageItem);
            var favoritesArray = angular.fromJson(favoritesString);
            if (!Array.isArray(favoritesArray)) {
                favoritesArray = [];
            };
            for (var i = 0; i < favoritesArray.length; i++) {
                var favorite = favoritesArray[i];
                if (favorite.id === $stateParams.id) {
                    return true;
                }
            }
        }

        function saveToFavorite(localStorageItem, vm, model, sendLikeStorageName) {
            var favoritesString = localStorage.getItem(localStorageItem);
            var favoritesArray = angular.fromJson(favoritesString);
            // If no item create empty bucket.
            if (!Array.isArray(favoritesArray)) {
                favoritesArray = []
            }
            for (var i = 0; i < favoritesArray.length; i++) {
                var favorite = favoritesArray[i];
                // If current favorite exists;
                if (favorite.id === $stateParams.id) {
                    favoritesArray.splice(i, 1);
                    favoritesString = angular.toJson(favoritesArray);
                    localStorage.setItem(localStorageItem, favoritesString);
                    vm.styleFavorite = false;
                    Message.popUp.alert.default('즐겨찾기 알림', '즐겨찾기에서 삭제되었습니다.');
                    return false;
                }
            }
            // If current favorite does not exist then save;
            var favoriteToSave = {
                id: model.current.id,
            }

            addToAttributes(model, favoriteToSave);

            console.log(favoriteToSave);
            favoritesArray.push(favoriteToSave);
            favoritesString = angular.toJson(favoritesArray);
            localStorage.setItem(localStorageItem, favoritesString);
            if (sendLikeStorageName) {
                sendLike(sendLikeStorageName, favoriteToSave.id);
            }
            vm.styleFavorite = true;
            Message.popUp.alert.default('즐겨찾기 알림', '즐겨찾기에 추가되었습니다.')
        }

        function addToAttributes(model, favoriteToSave) {
            if (model.current.name) {
                favoriteToSave.name = model.current.name;
            }
            if (model.current.title) {
                favoriteToSave.title = model.current.title;
            }
            if (model.current.photos.length > 0) {
                favoriteToSave.photos = [{
                    url: model.current.photos[0].url
                }]
            }
            if (model.current.location) {
                favoriteToSave.location = {
                    coordinates: model.current.location.coordinates
                }
            }
            if (model.current.address) {
                favoriteToSave.address = model.current.address;
            }
            if (model.current.createdBy) {
                favoriteToSave.createdBy = {};
                favoriteToSave.createdBy.username = model.current.createdBy.username;
            }
            if (model.current.likes) {
                favoriteToSave.likes = model.current.likes;
            }
            if (model.current.comments) {
                favoriteToSave.comments = [];
                for (var i = 0; i < model.current.comments.length; i++) {
                    favoriteToSave.comments.push(1);
                }
            }
        }

        function sendLike(likedOnceStorageItem, id) {
            // add to liked once list
            var likedOnceString = localStorage.getItem(likedOnceStorageItem);
            var likedOnceArray = angular.fromJson(likedOnceString);
            if (!Array.isArray(likedOnceArray)) {
                likedOnceArray = []
            }
            for (var i = 0; i < likedOnceArray.length; i++) {
                var currentId = likedOnceArray[i];
                if (currentId === id) {
                    return false;
                }
            }
            likedOnceArray.push(id);
            likedOnceString = angular.toJson(likedOnceArray);
            localStorage.setItem(likedOnceStorageItem, likedOnceString);

            Posts.likePost({
                id: id
            }).$promise
                .then(function success(data) {
                    console.log(data);
                }, function err(error) {
                    console.log(error);
                });
        }
    } // Service END
})();

(function() {
    'use strict';
    angular.module('app')
        .factory('LocalService', function() {
            return {
                get: function(key) {
                    return localStorage.getItem(key);
                },
                set: function(key, val) {
                    return localStorage.setItem(key, val);
                },
                unset: function(key) {
                    return localStorage.removeItem(key);
                },
                getSession: function(key) {
                    return sessionStorage.getItem(key);
                },
                setSession: function(key, val) {
                    return sessionStorage.setItem(key, val);
                },
                unsetSession: function(key) {
                    return sessionStorage.removeItem(key);
                }
            }
        });


})();

(function() {
    'use strict';
    angular.module('app')
        .factory('Message', Message);

    Message.$inject = ['$ionicLoading', '$ionicPopup'];

    function Message($ionicLoading, $ionicPopup) {
        var service = {

            loading: {
                default: loadingDefault,
                hide: loadingHide
            },
            message: {
                success: messageSuccess,
                error: messageError
            },
            popUp: {
                alert: {
                    default: popUpAlertDefault
                }
            }
        };

        return service;

        function loadingDefault(message) {
            $ionicLoading.show(message);
        }

        function messageSuccess(message) {
            $ionicLoading.show({
                template: '<h4 class="message-success">' + message + '</h4>',
                duration: 2000
            });
        }

        function messageError(message) {
            $ionicLoading.show({
                template: '<h4 class="message-error">' + message + '</h4>',
                duration: 2000
            });
        }

        function loadingHide() {
            $ionicLoading.hide();
        }

        function popUpAlertDefault(title, message) {
            return $ionicPopup.alert({
                title: title || '인터넷이 끊겼습니다.',
                template: message || '인터넷을 켜주세요.'
            });
        }


    }


})();

// Fixes the case where parent veritcal scrolling is disabled on ion-scroll
// element.

// Usage
// ion-scroll[direction="x" scroll-parent]
(function() {
    'use strict';

    angular.module('app')
        .directive('parentScroll', parentScroll);

    parentScroll.$inject = ['$ionicScrollDelegate', '$timeout', '$window'];

    function parentScroll($ionicScrollDelegate, $timeout, $window) {
        return {
            scope: true,
            restrict: 'A',
            compile: compile
        };

        function compile(element, attr) {

            if (!$window.horizontalIonScrollCount) {
                $window.horizontalIonScrollCount = 0;
            }

            $window.horizontalIonScrollCount++
            attr.delegateHandle = "horizontal" + $window.horizontalIonScrollCount;

            return function(scope, element, attr) {
                $timeout(function() {
                    var horizontal = attr.delegateHandle;
                    var sv = $ionicScrollDelegate.$getByHandle(horizontal).getScrollView();

                    var container = sv.__container;

                    var originaltouchStart = sv.touchStart;
                    var originalmouseDown = sv.mouseDown;
                    var originaltouchMove = sv.touchMove;
                    var originalmouseMove = sv.mouseMove;

                    container.removeEventListener('touchstart', sv.touchStart);
                    container.removeEventListener('mousedown', sv.mouseDown);
                    document.removeEventListener('touchmove', sv.touchMove);
                    document.removeEventListener('mousemove', sv.mousemove);


                    sv.touchStart = function(e) {
                        e.preventDefault = function() {}
                        originaltouchStart.apply(sv, [e]);
                    }

                    sv.touchMove = function(e) {
                        e.preventDefault = function() {}
                        originaltouchMove.apply(sv, [e]);
                    }

                    sv.mouseDown = function(e) {
                        e.preventDefault = function() {}

                        if (originalmouseDown) {
                            originalmouseDown.apply(sv, [e]);
                        }

                    }


                    sv.mouseMove = function(e) {
                        e.preventDefault = function() {}

                        if (originalmouseMove) {
                            originalmouseMove.apply(sv, [e]);
                        }

                    }

                    container.addEventListener("touchstart", sv.touchStart, false);
                    container.addEventListener("mousedown", sv.mouseDown, false);
                    document.addEventListener("touchmove", sv.touchMove, false);
                    document.addEventListener("mousemove", sv.mouseMove, false);
                })

            }
        }
    }

})();

//==========================================================================
//              Style for user selection.
//==========================================================================

(function() {
    'use strict';

    angular.module('app')
        .directive('touch', touch);

    touch.$inject = ['$timeout'];

    function touch($timeout) {
        return {
            restrict: 'A',
            link: link
        };

        function link(scope, element, attrs) {
            element.on('click', function(e) {
                element.addClass('touch');
                $timeout(function() {
                    element.removeClass('touch');
                }, 50);

            });
        }
    }

})();

// Makes width of the view available as JS or directive such as collection repeat
// This makes collection repeat to have dynamic width or height which depends on
//the view width or view height;

// usage:
// Required: IndexModel.vw = INT;
// In index.html, body[vw]
// 1) ion-list>ion-item[collection-repeat="item in items" item-height="vw * 0.20"]
// 2) ANY[vw]
// 3) function controller(IndexModel){
//     console.log(IndexModel.vw);
//    }
(function() {
    'use strict';

    angular.module('app')
        .directive('vw', vw);

    vw.$inject = ['$rootScope', '$window'];

    function vw($rootScope, $window) {
        return {
            link: link
        }

        function link(scope, element, attrs) {
            $rootScope.vw = element.prop('offsetWidth');

            $window.addEventListener('resize', function() {
                $rootScope.$apply(function() {
                    $rootScope.vw = element.prop('offsetWidth');
                });
            });
        }
    }


})();

(function() {
    'use strict';
    angular.module('app')
        .filter('filterByTag', filterByTag)

    // filterByTag.$inject = [];
    function filterByTag() {

        return filter;

        function filter(collection, tagName) {
            var resultArray = [];
            if (collection) {

                for (var i = 0; i < collection.length; i++) {
                    var element = collection[i];
                    for (var j = 0; j < element.tags.length; j++) {
                        var tag = element.tags[j];
                        if (tag === tagName) {
                            resultArray.push(element);
                        }
                    }
                }
            }
            return resultArray;
        }
    }


})();

(function() {
    'use strict';

    angular.module('app')
        .controller('EventDetailController', EventDetailController);

    EventDetailController.$inject = ['EventDetailModel', 'Posts', 'Message', '$stateParams', '$scope'];

    function EventDetailController(EventDetailModel, Posts, Message, $stateParams, $scope) {

        var EventDetail = this;
        EventDetail.Model = EventDetailModel;

        $scope.$on('$ionicView.beforeEnter', function() {
            getPosts();
        });

        //------------------------
        //  IMPLEMENTATIONS
        //------------------------
        function getPosts() {
            Message.loading.default();
            Posts.get({
                id: $stateParams.id
            }).$promise
                .then(function success(data) {
                    console.log(JSON.stringify(data, null, 2));
                    EventDetailModel.post = data;
                    Message.loading.hide();

                }, function error(err) {
                    Message.popUp.alert.default('이벤트 알림', '종료된 이벤트입니다.');
                });
        }
    } //END

})();
(function() {
    'use strict';
    angular.module('app')
        .factory('EventDetailModel', EventDetailModel);



    function EventDetailModel() {
        var model = {
            post: {
                id: '',
                comments: [],
                photos: [{
                    url: ''
                }],
                content: '',
                title: '',
                category: 'SHOW-POST',
                createdBy: {
                    nickname: ''
                }
            }
        };

        return model;
    }


})();
(function() {
    'use strict';


    angular.module('app')
        .controller('EventListController', EventListController);

    EventListController.$inject = ['EventListModel', 'Posts', '$state', '$scope', 'Message'];

    function EventListController(EventListModel, Posts, $state, $scope, Message) {

        var EventList = this;
        EventList.Model = EventListModel;

        $scope.$on('$ionicView.beforeEnter', function() {
            if (EventListModel.postsWrapper.posts.length < 10) {
                Message.loading.default();

                Posts.getPosts({
                    category: 'EVENT-POST',
                    sort: 'id DESC',
                    limit: 10
                }).$promise
                    .then(function success(data) {
                        EventListModel.postsWrapper = data;
                        console.log(data);
                        Message.loading.hide();
                    }, function error(err) {
                        Message.popUp.alert.default();
                    });
            }
        });

        EventList.goToDetailHandler = function(post) {
            $state.go('main.announcements.eventDetail', {
                id: post.id
            })
        };
        //------------------------
        // Check for newer stuff;
        //------------------------
        EventList.getNewerPosts = function() {
            var currentPosts = EventListModel.postsWrapper.posts;
            Posts.getPosts({
                category: 'EVENT-POST',
                limit: 10,
                newerThan: currentPosts[0].id
            }).$promise
                .then(function success(data) {
                    if (!data.posts.length) {
                        Message.popUp.alert.default(
                            '이벤트 알림',
                            '새로운 이벤트가 없습니다.'
                        );
                    }
                    data.posts.forEach(function(post, i, self) {
                        currentPosts.unshift(post);
                    })
                    $scope.$broadcast('scroll.refreshComplete');
                }, function error(err) {
                    Message.popUp.alert.default();
                    $scope.$broadcast('scroll.refreshComplete');
                })
        }
        //------------------------
        //  Check for older stuff
        //------------------------
        EventList.getOlderPosts = function() {
            var currentPosts = EventListModel.postsWrapper.posts;
            Posts.getPosts({
                category: 'EVENT-POST',
                sort: 'id DESC',
                limit: 10,
                olderThan: currentPosts[currentPosts.length - 1].id
            }).$promise
                .then(function success(data) {
                    data.posts.forEach(function(post, i, self) {
                        currentPosts.push(post);
                    })
                    $scope.$broadcast('scroll.infiniteScrollComplete');
                    EventListModel.postsWrapper.more = data.more;
                }, function error(err) {
                    Message.popUp.alert.default();
                    $scope.$broadcast('scroll.infiniteScrollComplete');
                });
        };
        // Check if there is more data if none infinite-scroll is disabled.;
        EventList.checkForMore = function() {
            return EventListModel.postsWrapper.more;
        };
    }

})();
(function() {
    'use strict';

    angular.module('app')
        .factory('EventListModel', EventListModel)

    function EventListModel() {
        var model = {
            postsWrapper: {
                posts: [{
                    title: '',
                    content: '',
                    category: '',
                    comments: [],
                    photos: [{
                        url: ''
                    }]
                }],
                more: true
            }
        }

        return model;
    }

})();
(function() {
    'use strict';
    angular.module('app')
        .controller('NoticeDetailController', NoticeDetailController);

    NoticeDetailController.$inject = ['NoticeDetailModel', 'Posts', '$stateParams', '$scope', 'Message']


    function NoticeDetailController(NoticeDetailModel, Posts, $stateParams, $scope, Message) {

        var NoticeDetail = this;

        NoticeDetail.Model = NoticeDetailModel;

        $scope.$on('$ionicView.beforeEnter', function() {

            //------------------------
            //  Load post with id
            //------------------------
            Message.loading.default();
            Posts.findById({
                id: $stateParams.id
            }).$promise
                .then(function success(data) {
                    console.log(JSON.stringify(data, null, 2));
                    NoticeDetailModel.post = data;
                    Message.loading.hide();

                }, function error(err) {
                    Message.popUp.alert.default('해당포스트가 없습니다', '지워진 포스트이거나 인터넷이 꺼져있습니다.');
                });
        });
    }
})();
(function() {
    'use strict';
    angular.module('app')
        .factory('NoticeDetailModel', NoticeDetailModel);

    function NoticeDetailModel() {

        var model = {
            post: {
                id: '',
                comments: [],
                photos: [{
                    url: ''
                }],
                content: '',
                title: '',
                category: 'SHOW-POST',
                createdBy: {
                    nickname: ''
                }
            }
        };

        return model;
    }


})();
(function() {
    'use strict';
    angular.module('app')
        .controller('NoticeListController', NoticeListController);

    NoticeListController.$inject = ['NoticeListModel', 'Posts', '$state', '$scope', 'Message'];

    function NoticeListController(NoticeListModel, Posts, $state, $scope, Message) {

        var NoticeList = this;

        NoticeList.Model = NoticeListModel;

        $scope.$on('$ionicView.beforeEnter', function() {
            if (NoticeListModel.postsWrapper.posts.length < 10) {
                Message.loading.default();

                Posts.getPosts({
                    category: 'NOTICE-POST',
                    sort: 'id DESC',
                    limit: 10
                }).$promise
                    .then(function success(data) {
                        NoticeListModel.postsWrapper = data;
                        Message.loading.hide();
                    }, function error(err) {
                        Message.popUp.alert.default();
                    });
            }
        });

        NoticeList.goToDetailHandler = function(post) {
            $state.go('main.announcements.noticeDetail', {
                id: post.id
            });
        };
        //------------------------
        // Check for newer stuff;
        //------------------------
        NoticeList.getNewerPosts = function() {
            var currentPosts = NoticeListModel.postsWrapper.posts;
            Posts.getPosts({
                category: 'NOTICE-POST',
                limit: 10,
                newerThan: currentPosts[0].id
            }).$promise
                .then(function success(data) {
                    if (!data.posts.length) {
                        Message.popUp.alert.default(
                            '공지사항 알림',
                            '새로운 공지사항이 없습니다.'
                        );
                    }
                    data.posts.forEach(function(post, i, self) {
                        currentPosts.unshift(post);
                    });
                    $scope.$broadcast('scroll.refreshComplete');
                }, function error(err) {
                    Message.popUp.alert.default();
                    $scope.$broadcast('scroll.refreshComplete');
                });
        };
        //------------------------
        //  Check for older stuff
        //------------------------
        NoticeList.getOlderPosts = function() {
            var currentPosts = NoticeListModel.postsWrapper.posts;
            Posts.getPosts({
                category: 'NOTICE-POST',
                sort: 'id DESC',
                limit: 10,
                olderThan: currentPosts[currentPosts.length - 1].id
            }).$promise
                .then(function success(data) {
                    data.posts.forEach(function(post, i, self) {
                        currentPosts.push(post);
                    });
                    $scope.$broadcast('scroll.infiniteScrollComplete');
                    NoticeListModel.postsWrapper.more = data.more;
                }, function error(err) {
                    Message.popUp.alert.default();
                    $scope.$broadcast('scroll.infiniteScrollComplete');
                });
        };
        // Check if there is more data if none infinite-scroll is disabled.;
        NoticeList.checkForMore = function() {
            return NoticeListModel.postsWrapper.more;
        };

    }


})();
(function() {
    'use strict';

    angular.module('app')
        .factory('NoticeListModel', NoticeListModel);

    function NoticeListModel() {

        var model = {
            postsWrapper: {
                posts: [{
                    title: '',
                    content: '',
                    category: '',
                    comments: [],
                    photos: [{
                        url: ''
                    }]
                }],
                more: true
            }
        };

        return model;

    }

})();
(function() {
    'use strict';

    angular.module('app')
        .controller('BalanceDetailController', BalanceDetailController);

    BalanceDetailController.$inject = ['BalanceDetailModel'];

    function BalanceDetailController(BalanceDetailModel) {

        var BalanceDetail = this;
        BalanceDetail.Model = BalanceDetailModel;

    }

})();
(function() {
    'use strict';

    angular.module('app')
        .factory('BalanceDetailModel', BalanceDetailModel);

    // BalanceDetailModel.$inject = [];

    function BalanceDetailModel() {

        var model = {

        };
        return model;
    }
})();

(function() {
    'use strict';

    angular.module('app')
        .controller('BalanceListController', BalanceListController);

    BalanceListController.$inject = ['BalanceListModel'];

    function BalanceListController(BalanceListModel) {

        var BalanceList = this;

        BalanceList.places = BalanceListModel.places;

    }

})();
(function() {
    'use strict';
    angular.module('app')
        .factory('BalanceListModel', BalanceListModel);



    function BalanceListModel() {

        var model = {
            places: [{
                id: '222aaa',
                longitude: 12.121212,
                latitude: 155.13131,
                title: '우리 네일',
                titlePhoto: 'http://placehold.it/500x500',
                address: 'address 2'
            }, {
                id: 'asdfa1111',
                longitude: 12.121212,
                latitude: 155.13131,
                title: '우리 네일2',
                titlePhoto: 'http://placehold.it/500x500',
                address: 'address 2'
            }]
        };


        return model;
    }


})();
(function() {
    'use strict';

    angular.module('app')
        .controller('ShowDetailController', ShowDetailController);

    ShowDetailController.$inject = ['ShowDetailModel', 'Posts', 'Comments', '$stateParams', '$scope',
        'Message', 'Favorite'
    ];

    function ShowDetailController(ShowDetailModel, Posts, Comments, $stateParams, $scope,
        Message, Favorite
    ) {

        var ShowDetail = this;

        ShowDetail.Model = ShowDetailModel;
        ShowDetail.toggleSavePost = Favorite.saveToFavorite.bind(null, 'NAIL_SAVED_POSTS', ShowDetail, ShowDetailModel, 'NAIL_LIKED_ONCE');
        ShowDetail.addComment = addComment;

        $scope.$on('$ionicView.beforeEnter', function() {
            loadCurrent();
            ShowDetail.styleFavorite = Favorite.isFavorite('NAIL_SAVED_POSTS');
        });


        //------------------------
        //  Implementations
        //------------------------
        // TODO: Not working.
        function loadCurrent() {
            Message.loading.default();
            return Posts.findById({
                    id: $stateParams.id,
                    populates: 'comments',
                    eager: true
                }).$promise
                .then(function success(postWrapper) {
                    console.log(postWrapper.post);
                    ShowDetailModel.current = postWrapper.post;
                    Message.loading.hide();

                }, function error(err) {
                    Message.popUp.alert.default('해당포스트가 없습니다', '지워진 포스트이거나 인터넷이 꺼져있습니다.');
                });
        }

        function addComment(comment) {
            commentBody = {
                content: comment,
                post: $stateParams.id
            };
            Comments.addCommentToPost({}, commentBody).$promise
                .then(function success(data) {
                    Message.popUp.alert.default('댓글달기 알림', '댓글을 성공적으로 작성하셨습니다.');
                    ShowDetailModel.currentPost.comments.unshift(data);
                    console.log(data);

                }, function error(err) {
                    Message.popUp.alert.default('댓글달기 알림', '인터넷이 꺼져있습니다.');
                });
        }

    } //END

})();
(function() {
    'use strict';
    angular.module('app')
        .factory('ShowDetailModel', ShowDetailModel);

    function ShowDetailModel() {

        var model = {
            current: {
                id: '',
                comments: [],
                photos: [{
                    url: ''
                }],
                content: '',
                title: '',
                category: 'SHOW-POST',
                createdBy: {
                    nickname: ''
                }
            }
        };

        return model;

    }


})();

(function() {
    'use strict';

    angular.module('app')
        .controller('SavedShowListController', SavedShowListController);

    SavedShowListController.$inject = ['SavedShowListModel', '$state', '$scope'];

    function SavedShowListController(SavedShowListModel, $state, $scope) {

        var SavedShowList = this;

        SavedShowList.Model = SavedShowListModel;
        $scope.$on('$ionicView.beforeEnter', function() {
            SavedShowListModel.posts =
                angular.fromJson(localStorage.getItem('NAIL_SAVED_POSTS'));
        })




        SavedShowList.goToDetailHandler = function(post) {
            $state.go('main.show.detail', {
                id: post.id
            });
            //MVP2: resave. likeCounts, and commentCounts.
        };

        var savedList = [{
            id: '',
            titile: '',
            createdBy: {
                nickname: ''
            },
            photos: [],
            // Check if updated
            likeCount: '',
            commentCount: ''
        }];
    }

})();

(function() {
    'use strict';

    angular.module('app')
        .factory('SavedShowListModel', SavedShowListModel);

    SavedShowListModel.$inject = [];

    function SavedShowListModel() {

        var model = {

        };
        return model;
    }
})();

(function() {
    'use strict';
    angular.module('app')
        .controller('ShowListController', ShowListController);

    ShowListController.$inject = ['ShowListModel', 'Posts', '$state', '$scope',
        'Message'
    ];

    function ShowListController(ShowListModel, Posts, $state, $scope,
        Message
    ) {

        var ShowList = this;

        ShowList.Model = ShowListModel;


        $scope.$on('$ionicView.beforeEnter', function() {
            if (ShowListModel.postsWrapper.posts.length < 10) {
                Message.loading.default();

                Posts.getPosts({
                    category: 'SHOW-POST',
                    sort: 'id DESC',
                    limit: 10
                }).$promise
                    .then(function success(data) {
                        ShowListModel.postsWrapper = data;
                        Message.loading.hide();
                    }, function error(err) {
                        Message.popUp.alert.default();
                    });
            }
        });

        ShowList.goToDetailHandler = function(post) {
            $state.go('main.show.detail', {
                id: post.id
            });
        };
        //------------------------
        // Check for newer stuff;
        //------------------------
        ShowList.getNewerPosts = function() {
            var currentPosts = ShowListModel.postsWrapper.posts;
            Posts.getPosts({
                category: 'SHOW-POST',
                limit: 10,
                newerThan: currentPosts[0].id
            }).$promise
                .then(function success(data) {
                    if (!data.posts.length) {
                        Message.popUp.alert.default(
                            '새로운포스트가 없습니다',
                            '나중에 다시 확인해주세요'
                        );
                    }
                    data.posts.forEach(function(post, i, self) {
                        currentPosts.unshift(post);
                    })
                    $scope.$broadcast('scroll.refreshComplete');
                }, function error(err) {
                    Message.popUp.alert.default();
                    $scope.$broadcast('scroll.refreshComplete');
                })
        }
        //------------------------
        //  Check for older stuff
        //------------------------
        ShowList.getOlderPosts = function() {
            var currentPosts = ShowListModel.postsWrapper.posts;
            Posts.getPosts({
                category: 'SHOW-POST',
                sort: 'id DESC',
                limit: 10,
                olderThan: currentPosts[currentPosts.length - 1].id
            }).$promise
                .then(function success(data) {
                    data.posts.forEach(function(post, i, self) {
                        currentPosts.push(post);
                    })
                    $scope.$broadcast('scroll.infiniteScrollComplete');
                    ShowListModel.postsWrapper.more = data.more;
                }, function error(err) {
                    Message.popUp.alert.default();
                    $scope.$broadcast('scroll.infiniteScrollComplete');
                });
        };
        // Check if there is more data if none infinite-scroll is disabled.;
        ShowList.checkForMore = function() {
            return ShowListModel.postsWrapper.more;
        };

    }


})();

(function() {
    'use strict';

    angular.module('app')
        .factory('ShowListModel', ShowListModel);

    function ShowListModel() {

        var model = {
            postsWrapper: {
                posts: [{
                    title: '',
                    content: '',
                    category: '',
                    comments: [],
                    photos: [{
                        url: ''
                    }]
                }],
                more: true
            },


        };

        return model;

    }

})();

(function() {
    'use strict';
    angular.module('app')
        .controller('AnnouncementsController', AnnouncementsController);

    AnnouncementsController.$inject = ['$state'];

    function AnnouncementsController($state) {

        var Announcements = this;

        Announcements.goToEventListHandler = function() {
            $state.go('main.announcements.eventList')
        }
        Announcements.goToNoticeListHandler = function() {
            $state.go('main.announcements.noticeList')
        }
    }


})();
(function() {
    'use strict';
    angular.module('app')
        .factory('AnnouncementsModel', AnnouncementsModel);



    function AnnouncementsModel() {
        var model = {

        };

        return model;

    }


})();
(function() {
    'use strict';
    angular.module('app')
        .controller('BalanceController', BalanceController)

    BalanceController.$inject = ['BalanceModel'];

    function BalanceController(BalanceModel) {

        var Balance = this;
        Balance.Model = BalanceModel;


        //------------------------
        //  IMPLEMENTATIONS
        //------------------------
    }
})();

(function() {
    'use strict';

    angular.module('app')
        .factory('BalanceModel', BalanceModel);

    BalanceModel.$inject = [];

    function BalanceModel() {

        var model = {

        };
        return model;
    }
})();

(function() {
    'use strict';

    angular.module('app')
        .controller('CancelController', CancelController);

    CancelController.$inject = ['CancelModel', 'Bookings', 'Message', '$scope'];

    function CancelController(CancelModel, Bookings, Message, $scope) {

        var Cancel = this;
        Cancel.Model = CancelModel;

        Cancel.cancelHandler = updateStatus.bind(null, 'CACNCELLED');
        Cancel.isNotCancelled = isNotCancelled;

        $scope.$on('$ionicView.beforeEnter', function() {
            getMyBookings();
        })


        //------------------------
        //  IMPLEMENTATIONS
        //------------------------
        function getMyBookings() {
            return Bookings.getMyBookings({
                    from: moment().clone().subtract(2, 'hours').toDate().getTime(),
                    to: moment().clone().add(1, 'years').toDate().getTime(),
                }).$promise
                .then(function success(bookingsWrapper) {
                    CancelModel.current.bookings = bookingsWrapper.bookings;
                }, function err(error) {
                    Message.popUp.alert.default('인터넷이 꺼져있습니다', '인터넷을 연결해주세요.');
                    console.log(error);
                });
        }

        function updateStatus(statusString, id, index) {
            return Bookings.updateBooking({
                    id: id
                }, {
                    status: statusString
                }).$promise
                .then(function success(data) {
                    Message.popUp.alert.default('예약취소 알림', '예약이 취소 되었습니다.');
                    Array.prototype.splice.call(CancelModel.current.bookings, index, 1);

                }, function err(error) {

                });
        }

        function isNotCancelled(booking) {
            return booking.status !== 'CANCELLED';
        }
    } // Factory END

})();
(function() {
    'use strict';
    angular.module('app')
        .factory('CancelModel', CancelModel);

    // CancelModel.$inject = [];

    function CancelModel() {
        var data = {
            current: {
                bookings: [{
                    datetime: new Date(),
                    products: [{
                        product: {
                            name: '우늘 네일'
                        },
                        amount: 1
                    }],
                    place: {
                        name: 'place1'
                    },
                    status: 'CANCELLED'
                }, {
                    datetime: new Date(),
                    products: [{
                        product: {
                            name: '오늘 네일 2'
                        },
                        amount: 1
                    }],
                    place: {
                        name: 'place2'
                    },
                    status: 'PROCESSING'
                }]
            }
        };

        return data;


        //------------------------
        //  IMPLEMENTATIONS
        //------------------------
    }

})();
(function() {
    'use strict';

    angular.module('app')
        .controller('DaumMapController', DaumMapController);

    DaumMapController.$inject = ['DaumMapModel', '$ionicModal', '$scope', '$state',
        '$stateParams', 'Dom'
    ];

    function DaumMapController(DaumMapModel, $ionicModal, $scope, $state,
        $stateParams, Dom
    ) {

        var Map = this;

        Map.Model = DaumMapModel;

        Map.findMeThenSearchNearBy = function() {
            return DaumMapModel.findMeThenSearchNearBy();
        };

        Map.searchLocationNearBy = function(value) {
            return DaumMapModel.searchLocationNearBy(value);
        };

        Map.goToDetailHandler = function() {
            DaumMapModel.modal.hide();
            $state.go('main.detail', {
                id: DaumMapModel.selectedPlace.id
            });
        };
        Map.goToHandler = function(state, params) {
            $state.go(state, params);
        };

        // Make currently selected place from DaumMapDirective available at ModalView
        Map.selectedPlace = DaumMapModel.selectedPlace;

        $scope.$on('$ionicView.enter', function() {
            // Set Modal
            $ionicModal.fromTemplateUrl('state/daumMap/placeModal.html', {
                scope: $scope,
                animation: 'slide-in-up'
            })
                .then(function(modal) {
                    DaumMapModel.modal = modal;
                });
            DaumMapModel.domMap.relayout();
        });

        //------------------------
        //  APP SPECIFIC FUNCTION
        //------------------------
        $scope.$on('$ionicView.enter', function() {
            focusInput($stateParams, Dom);
        })

        function focusInput($stateParams, Dom) {
            if ($stateParams.from === 'homeInput') {
                Dom.focusById('daum-map-search-input');
            }
        }


    }

})();
(function() {
    'use strict';

    angular.module('app')
        .directive('daumMap', daumMap);

    daumMap.$inject = ['DaumMapModel', 'Places', 'Bookings', '$state', '$cordovaGeolocation', 'Message', '$q',
        '$stateParams'
    ];

    function daumMap(DaumMapModel, Places, Bookings, $state, $cordovaGeolocation, Message, $q, $stateParams) {
        return {
            scope: {
                markerSrc: '@',
                markerClickedSrc: '@',
                markerWidth: '@',
                markerHeight: '@',
            },
            compile: function(element, attr) {
                //==========================================================================
                //              Global Map Property
                //==========================================================================
                // Initiate map
                var interval = 30;
                var DOM = element[0];
                var mapOptions = {
                    center: new daum.maps.LatLng(37.5, 127),
                    level: 4,
                    draggable: true
                };
                daum.maps.disableHD();
                var map = new daum.maps.Map(DOM, mapOptions);
                // place service
                var ps = new daum.maps.services.Places();
                // ==========================================================================
                //              HELPER FUNCTIONS
                // ==========================================================================
                // filter query
                function filterPlaces(places, rangeMinutes) {

                    var currentMoment = setCurrentMoment();

                    var arrayOfIds = _.pluck(places, 'id');

                    var arrayOfPromises = _.map(arrayOfIds, function(id, i, self) {
                        return Bookings.getBookingsDateBetween({
                            placeId: id,
                            from: currentMoment.clone().set({
                                hour: 0,
                                minute: 0,
                                second: 0
                            }).toDate().getTime(),
                            to: currentMoment.clone().set({
                                hour: 23,
                                minute: 59,
                                second: 59
                            }).toDate().getTime()
                        }).$promise
                    });

                    return $q.all(arrayOfPromises)
                        .then(function success(arrayOfBookingsWrapper) {

                            var availabilities = checkAvailableSlots(places, arrayOfBookingsWrapper, interval, currentMoment, rangeMinutes);

                            if (availabilities.length === 0) {
                                return [];
                            }
                            for (var i = places.length - 1; i >= 0; i--) {
                                if (availabilities[i] === 'unavailable') {
                                    places.splice(i, 1);
                                }
                            };

                            return places

                        }, function err(arrayOfErrors) {
                            console.log(arrayOfErrors);
                        });
                }

                function setCurrentMoment() {
                    var currentHour = moment().get('hour');
                    var currentMinute = moment().get('minute');
                    if (currentMinute <= 30) {
                        var currentMoment = moment().set({
                            minutes: 29
                        });
                    } else {
                        var currentMoment = moment().set({
                            minutes: 59
                        });
                    }
                    return currentMoment;
                }

                function checkAvailableSlots(places, arrayOfBookingsWrapper, interval, currentMoment, rangeMinutes) {
                    var todayInt = currentMoment.clone().get('day');

                    var closingMomentsForToday = [];
                    angular.forEach(places, function(place, i) {
                        console.log(place);
                        var endHourArray = place.openingHours[todayInt].end.split(':')
                        var hours = endHourArray[0];
                        var minutes = endHourArray[1];
                        var closingMoment = moment().set({
                            hour: hours,
                            minutes: minutes
                        });
                        if (place.openingHours[todayInt].start === place.openingHours[todayInt].end) {
                            places.splice(i, 1, null)
                            arrayOfBookingsWrapper.splice(i, 1, null);
                        } else if (currentMoment.isAfter(closingMoment)) {
                            places.splice(i, 1, null);
                            arrayOfBookingsWrapper.splice(i, 1, null);
                        } else {
                            closingMomentsForToday.push(closingMoment);
                        }
                    })
                    for (var i = places.length - 1; i >= 0; i--) {
                        if (places[i] === null) {
                            places.splice(i, 1);
                            arrayOfBookingsWrapper.splice(i, 1);
                        }
                    };
                    if (places.length === 0) {
                        Message.popUp.alert.default('바로검색 알림', '지금은 검색주위의 샵들이 모두 닫았습니다, 내일 이용해주시거나, 다른지역을 검색해주세요')
                        return [];
                    }



                    var arrayOfBookings = _.map(arrayOfBookingsWrapper, function(bookingsWrapper) {
                        return bookingsWrapper.bookings;
                    });
                    console.log('arrayOfBookings');
                    console.log(arrayOfBookings);
                    var employees = _.map(places, function(place) {
                        return place.employee
                    })
                    var arrayOfDurations = _.map(arrayOfBookings, function(bookings) {
                        return _.map(bookings, function(booking) {
                            return booking.products[0].product.duration
                        })
                    })
                    var arrayOfBookingsMoment = []; // [ [newbooking, newbooking,... ], []]
                    for (var i = 0; i < arrayOfDurations.length; i++) {
                        var resultArray_i = []; // inner [] of resultArray = [ [], [], ... ]
                        var bookings = arrayOfBookings[i];
                        var durations = arrayOfDurations[i];
                        var place = places[i];
                        console.log('place');
                        console.log(place);
                        for (var j = 0; j < durations.length; j++) {
                            var booking = bookings[i];
                            var datetime = booking.datetime
                            var bookingMoment = moment(datetime);
                            var duration = durations[i];
                            var closingMoment = closingMomentsForToday[i];
                            if (bookingMoment.isBetween(currentMoment.clone(), currentMoment.clone().add(rangeMinutes, 'minutes')) &&
                                bookingMoment.isBefore(closingMoment.clone())) {
                                resultArray_i.push(bookingMoment);
                            }
                            var slotsTaken = Math.ceil(duration / interval);
                            for (var k = 0; k < slotsTaken; k++) {
                                var minutesToAdd = interval * (k + 1);
                                var trailingBookingMoment = bookingMoment.clone().add(minutesToAdd, 'minutes');
                                if (trailingBookingMoment.isBetween(currentMoment.clone(), currentMoment.clone().add(rangeMinutes, 'minutes')) &&
                                    trailingBookingMoment.isBefore(closingMoment.clone())) {
                                    resultArray_i.push(trailingBookingMoment);
                                }
                            }
                        }
                        arrayOfBookingsMoment.push(resultArray_i);
                    }
                    console.log('arrayOfBookingsMoment');
                    console.log(arrayOfBookingsMoment);


                    var arrayOfTimeStrings = [];
                    for (var i = 0; i < arrayOfBookingsMoment.length; i++) {
                        var bookingsMoment = arrayOfBookingsMoment[i];
                        console.log(bookingsMoment);
                        var timeStrings = _.map(bookingsMoment, function(bookingMoment) {
                            var hours = bookingMoment.get('hours');
                            var minutes = bookingMoment.get('minutes')
                            var timeString = String(hours) + ':' + String(minutes);
                            return timeString;
                        });
                        if (timeStrings.length === 0) {
                            timeStrings = ['available']
                        }
                        arrayOfTimeStrings.push(timeStrings);
                    }
                    console.log('arrayOfTimeStrings');
                    console.log(arrayOfTimeStrings);

                    var arrayOfGroupedTimeStrings = [];
                    angular.forEach(arrayOfTimeStrings, function(timeStrings) {
                        var groupedTimeStrings = _.groupBy(timeStrings, function(timeString) {
                            return timeString;
                        })
                        arrayOfGroupedTimeStrings.push(groupedTimeStrings);
                    })
                    console.log('arrayOfGroupedTimeStrings');
                    console.log(arrayOfGroupedTimeStrings);

                    var availabilities = [];
                    for (var i = 0; i < arrayOfGroupedTimeStrings.length; i++) {
                        var availabilityFlag = false;
                        var place = places[i];
                        for (var key in arrayOfGroupedTimeStrings[i]) {
                            if (arrayOfGroupedTimeStrings[i][key].length < place.employee || key === 'available') {
                                availabilities.push('available')
                                availabilityFlag = true;
                                break
                            }
                        }
                        if (availabilityFlag === false) {
                            availabilities.push('unavailable');
                        }
                    }
                    console.log('availabilities');
                    console.log(availabilities);
                    return availabilities;
                }

                function processPin(markerImg, markerClickedImg, scope) {

                    angular.forEach(DaumMapModel.places, function(place, i, self) {
                        //place = {location:{type:'Point', coordinates:[126.10101, 27.101010]}, ...}
                        var placeLongitude = place.location.coordinates[0];
                        var placeLatitude = place.location.coordinates[1];
                        // set marker
                        var position = new daum.maps.LatLng(placeLatitude, placeLongitude);
                        var marker = new daum.maps.Marker({
                            map: map,
                            position: position,
                            // used as to link to place info
                            title: String(i),
                            image: markerImg,
                            clickable: true
                        })
                        daum.maps.event.addListener(marker, 'click', function() {
                            var marker = this;
                            scope.$apply(function() {
                                // on click: differentiate clicked image;
                                angular.forEach(DaumMapModel.markers, function(otherMarker, i, self) {
                                    otherMarker.setImage(markerImg);
                                });
                                marker.setImage(markerClickedImg);
                                // on click: show modal which will be filled with place info
                                // modal references DaumMapModel.selectedPlace to fill in the info
                                var index = Number(marker.getTitle());
                                Message.loading.default();

                                Places.findById({
                                    id: DaumMapModel.places[index].id,
                                    populates: 'photos'
                                }).$promise
                                    .then(function success(data) {
                                        Message.loading.hide();
                                        DaumMapModel.selectedPlace = data;
                                        console.log(DaumMapModel.selectedPlace)
                                        DaumMapModel.modal.show();
                                    }, function err(error) {
                                        Message.loading.hide();
                                        Message.popUp.alert.default();

                                    });
                                // DaumMapModel.selectedPlace = DaumMapModel.places[index];
                            });
                        });
                        // Save converted place with click event added.
                        DaumMapModel.markers.push(marker);
                    });
                }
                // Draw Markers after query
                var drawMarkers = function(currentCenter, markerImg, markerClickedImg, scope) {
                    // Reset previous markers;
                    angular.forEach(DaumMapModel.markers, function(marker, i, self) {
                        marker.setMap(null);
                    });
                    DaumMapModel.markers = [];

                    // Request server for places;
                    Places.getPlacesWithin({
                        latitude: currentCenter.latitude,
                        longitude: currentCenter.longitude,
                        distance: currentCenter.distance || 5000,
                        limit: currentCenter.limit || 50
                    }).$promise
                        .then(function success(placesWrapper) {

                            if ($stateParams.from === 'quick') {

                                filterPlaces(placesWrapper.places, 60)
                                    .then(function success(places) {
                                        DaumMapModel.places = places
                                        processPin(markerImg, markerClickedImg, scope);
                                    }, function err(error) {
                                        console.log(error);
                                    });

                            } else {
                                DaumMapModel.places = placesWrapper.places;
                                processPin(markerImg, markerClickedImg, scope);
                            }
                            Message.loading.hide();

                        }, function error(err) {
                            console.log(err);
                        });
                };

                //==========================================================================
                //              Find Current location and search nearby
                //==========================================================================
                DaumMapModel.findMeThenSearchNearBy = function() {
                    Message.loading.default();
                    $cordovaGeolocation.getCurrentPosition({
                        maximumAge: 3000,
                        timeout: 5000
                    })
                        .then(function success(position) {

                            if (position.coords == null) {
                                Message.loading.hide();
                                Message.popUp.alert.default(
                                    '위치 공유가 꺼져있습니다.',
                                    '위치 공유가 켜주세요.'
                                )
                                return false;
                            }
                            var result = {
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude
                            };

                            var currentCenter = DaumMapModel.currentPosition = result

                            map.setCenter(new daum.maps.LatLng(
                                DaumMapModel.currentPosition.latitude,
                                DaumMapModel.currentPosition.longitude
                            ));

                            // No longer needed as when map's center is moved it will draw.
                            // drawMarkers(currentCenter);
                            Message.loading.hide();
                        }, function error(err) {
                            console.log(err);
                            Message.loading.hide();
                            Message.popUp.alert.default(
                                '위치 공유가 꺼져있습니다.',
                                '위치 공유가 켜주세요.'
                            )
                        });
                };
                //==========================================================================
                //              Find specific location with value and search nearby
                //==========================================================================
                DaumMapModel.searchLocationNearBy = function(value) {
                    Message.loading.default();
                    if (!value) {
                        Message.loading.hide();
                        Message.popUp.alert.default('검색하기 알림', '장소 값을 넣어서 다시 검색해주세요');
                        return false;
                    }
                    ps.keywordSearch(value, function(status, data, pagination) {

                        // if no search result, notify and exit.
                        if (data.places[0] === undefined) {
                            Message.loading.hide();
                            Message.popUp.alert.default(
                                '요청하신 장소가 없습니다',
                                '다시검색해주세요'
                            );
                            return false;
                        }
                        console.log(status);

                        // move to center of searched result.
                        map.panTo(new daum.maps.LatLng(
                            data.places[0].latitude,
                            data.places[0].longitude
                        ));
                        var currentCenter = {
                            latitude: data.places[0].latitude,
                            longitude: data.places[0].longitude
                        };

                        // No longer needed as when map's center is moved it will draw.
                        // drawMarkers(currentCenter);

                        Message.loading.hide();
                    }, function(err) {
                        console.log(err);
                        console.log(err);
                        Message.loading.hide();
                        Message.popUp.alert.default({
                            title: '위치 공유가 꺼져있습니다.',
                            template: '위치 공유가 켜주세요.'
                        })
                    });
                };
                return function(scope, element, attr) {
                    // Marker style properties.
                    var markerSize = new daum.maps.Size(scope.markerWidth, scope.markerHeight);
                    var markerImg = new daum.maps.MarkerImage(scope.markerSrc, markerSize);
                    var markerClickedImg = new daum.maps.MarkerImage(scope.markerClickedSrc, markerSize);
                    map.relayout();
                    DaumMapModel.domMap = map;
                    // ------------------------
                    //  Search when moved
                    // ------------------------

                    daum.maps.event.addListener(map, 'idle', function() {

                        Message.loading.default();
                        var currentCenter = {
                            longitude: map.getCenter().getLng(),
                            latitude: map.getCenter().getLat()
                        }

                        angular.extend(currentCenter, {
                            distance: 2000,
                            limit: 20
                        });

                        console.log(currentCenter);
                        drawMarkers(currentCenter, markerImg, markerClickedImg, scope);

                    });
                };
            }
        };
    }

})();

(function() {
    'use strict';
    angular.module('app')
        .factory('DaumMapModel', [

            '$http', '$q', 'governorUrl',

            function($http, $q, governorUrl) {
                var DaumMapModel = {
                    // need to specify category for search
                    category: 'NAIL-PLACE', // only one category hence fixed
                    currentPosition: {
                        latitude: 'FLOAT',
                        longitude: 'FLOAT'
                    },
                    markers: [],
                    places: [],
                    selectedPlace: {
                        // response.places[n] selected from DaumMapDirective
                    },
                    modal: {
                        //Defined in DaumMapController
                    },
                    findMeThenSearchNearBy: function() {
                        //Defined in DaumMapDirective
                    },
                    searchLocationNearBy: function() {
                        //Defined in DaumMapDirective
                    },
                };

                return DaumMapModel;
            }

        ])
})();
(function() {
    'use strict';

    angular.module('app')
        .controller('DetailController', DetailController);

    DetailController.$inject = [
        'DetailModel', '$stateParams', '$scope', 'Message', 'Places',
        '$ionicSlideBoxDelegate', '$state', 'Favorite', '$filter'
    ]

    function DetailController(DetailModel, $stateParams, $scope, Message, Places,
        $ionicSlideBoxDelegate, $state, Favorite, $filter
    ) {
        var filterByTag = $filter('filterByTag');

        var Detail = this;
        Detail.Model = DetailModel;

        // Detail.date will update as user picks the date.
        Detail.date = moment();
        Detail.isFavorite = Favorite.isFavorite.bind(null, 'NAIL_SAVED_PLACES');
        Detail.interiorPhotos = [];
        Detail.portFolioPhotos = [];
        Detail.toggleSavePlace = Favorite.saveToFavorite.bind(null, 'NAIL_SAVED_PLACES', Detail, DetailModel);

        $scope.$on('$ionicView.beforeEnter', function() {
            loadPlace();
        });
        //------------------------
        //  IMPLEMENTATIONS
        //------------------------
        function loadPlace() {
            Message.loading.default();

            Places.findById({
                id: $stateParams.id,
                populates: 'photos,products,bookings'
            }).$promise
                .then(function success(place) {
                    DetailModel.current = place;
                    Detail.interiorPhotos = filterByTag(DetailModel.current.photos, 'INTERIOR');
                    Detail.portFolioPhotos = filterByTag(DetailModel.current.photos, 'PORTFOLIO');

                    Message.loading.hide();
                    $ionicSlideBoxDelegate.update();

                }, function error(err) {
                    Message.popUp.alert.default(
                        '네일샵정보 알림',
                        '요청하신 네일샵은 더이상 존재하지 않습니다.'
                    );
                });
        }

    }
})();
(function() {
    'use strict';
    angular.module('app')
        .factory('DetailModel', DetailModel);

    DetailModel.$inject = ['$q', '$state', '$stateParams'];

    function DetailModel($q, $state, $stateParams) {

        var model = {

            current: {
                openingHours: [{
                    start: '00:00',
                    end: '00:00'
                }, {
                    start: '07:00',
                    end: '20:00'
                }, {
                    start: '07:00',
                    end: '20:00'
                }, {
                    start: '07:00',
                    end: '20:00'
                }, {
                    start: '07:00',
                    end: '20:00'
                }, {
                    start: '09:00',
                    end: '22:00'
                }, {
                    start: '09:00',
                    end: '22:00'
                }]
            },
            selectedDate: {
                // dt from datepickeruibootstrap
                current: 'BOOL',
                customClass: 'STRING',
                date: 'DATE',
                disabled: 'BOOL',
            },
            //Coupled with ui-BootStrap.datePicker and
            //DetailModel.selectedDate
            dayClickHandler: function(dt) {
                // copies selected date then do below;
                var shopId = $stateParams.id;
                console.log(shopId);

                // selectedDate = 2015-08-04
                var selectedDate = moment(dt.date)

                // var bookings = DetailModel.currentPlace.bookings;

                // Parameters needed to requery a shop detail
                //as things might have changed since shop details.
                $state.go('main.schedule', {
                    id: shopId,
                    selectedDate: selectedDate.format('YYYY-MM-DD')
                })
            },

        };


        return model;

    }


})();
(function() {
    'use strict';
    angular.module('app')
        .controller('ListController', ListController);

    ListController.$inject = ['ListModel', '$state', '$scope', '$timeout'];

    function ListController(ListModel, $state, $scope, $timeout) {
        var List = this;

        // Link model to view;
        List.lists = ListModel.lists;

        // Go to details of the clicked item;
        List.itemHandler = function(item) {
            angular.copy(item, ListModel.currentItem);
            $state.go('main.detail', {
                id: item.id
            });
            console.log(item);
        };

        // Check for newer stuff
        List.doRefresh = function() {
            //http.get new stuff
            function final() {
                $scope.$broadcast('scroll.refreshComplete');
            }
        }

        // Check for older stuff;
        List.getData = function() {
            // http.get old stuff
            console.log('testing');

            function final(response) {
                if (response.posts.length === 10) {
                    ListModel.moreData = true;
                } else {
                    ListModel.moreData = false;
                }
                $scope.$broadcast('scroll.infiniteScrollComplete');
            }
        };

        // Check if there is more data;
        List.checkForMore = function() {
            return ListModel.moreData;
        };
    }


})();
(function() {
    'use strict';
    angular.module('app')
        .factory('ListModel', ListModel);

    function ListModel() {
        var model = {
            lists: [{
                id: 0,
                title: 'This is list 0',
                content: 'This is the content'
            }, {
                id: 1,
                title: 'This is list 1',
                content: 'This is the content of list 1'
            }, {
                id: 2,
                title: 'This is list 2',
                content: 'This is the content of list 2'
            }],
            currentItem: {},
            moreData: false
        };

        return model;
    }

})();
(function() {
    'use strict';

    angular.module('app')
        .controller('FavoriteController', FavoriteController);

    FavoriteController.$inject = ['FavoriteModel', '$scope', '$state'];

    function FavoriteController(FavoriteModel, $scope, $state) {
        var Favorite = this;
        Favorite.Model = FavoriteModel;

        $scope.$on('$ionicView.loaded', function() {
            Favorite.goToDetailHandler = function(place) {
                $state.go('main.detail', {
                    id: place.id
                });
            };
        });

        $scope.$on('$ionicView.beforeEnter', function() {
            FavoriteModel.placeList = angular.fromJson(localStorage.getItem('NAIL_SAVED_PLACES'));
        });
    }

})();
(function() {
    'use strict';

    angular.module('app')
        .factory('FavoriteModel', FavoriteModel);



    function FavoriteModel() {

        var model = {

        };

        return model;

    }

})();
(function() {
    'use strict';
    angular.module('app')
        .controller('LoginController', LoginController)

    LoginController.$inject = ['LoginModel'];

    function LoginController(LoginModel) {

        var Login = this;
        Login.Model = LoginModel;


        //------------------------
        //  IMPLEMENTATIONS
        //------------------------
    }
})();

(function() {
    'use strict';

    angular.module('app')
        .factory('LoginModel', LoginModel);

    // LoginModel.$inject = [];

    function LoginModel() {

        var model = {

        };
        return model;
    }
})();

(function() {
    'use strict';

    angular.module('app')
        .controller('MainController', MainController);

    MainController.$inject = ['$ionicSideMenuDelegate', 'MainModel', '$state', '$timeout',
        '$ionicNavBarDelegate', '$ionicHistory'
    ];

    function MainController($ionicSideMenuDelegate, MainModel, $state, $timeout,
        $ionicNavBarDelegate, $ionicHistory
    ) {

        var Main = this;

        Main.Model = MainModel;

        Main.toggleSideMenu = function() {
            $ionicSideMenuDelegate.toggleLeft();
        }


        Main.menuSelectHandler = function(item) {
            MainModel.currentItem = item;
            $state.go(item.state)
            $ionicSideMenuDelegate.toggleLeft(false);
        }

        Main.getCurrentState = function() {
            return $ionicHistory.currentStateName()
        }

        Main.toggleAccordion = function() {
            Main.settingSubMenu = !Main.settingSubMenu;
        }

        Main.toggleSettingHandler = function(setting) {
            if (MainModel.setting[setting] === 'on') {
                MainModel.setting[setting] = 'off'
            } else {
                MainModel.setting[setting] = 'on'
            }

            //req server to turn off setting.
        }

        Main.goToDaumMapHandler = function() {
            $state.go('main.daumMap');
        }

    } // END

})();
(function() {
    'use strict';

    angular.module('app')
        .factory('MainModel', MainModel);

    function MainModel() {
        var model = {
            sideMenuLists: [{
                state: 'main.home',
                text: '홈으로 가기'
            }, {
                state: 'main.show.savedList',
                text: '마이갤러리'
            }, {
                state: 'main.balance.list',
                text: '적립금 확인'
            }, {
                state: 'main.cancel',
                text: '예약 취소'
            }, {
                state: 'main.announcements.eventList',
                text: '이벤트 / 공지사항'
            }],
            currentItem: {
                state: 'main.home',
                text: '홈으로 가기'
            },
            setting: {
                location: 'on',
                push: 'on'
            }
        };

        return model;
    }

})();
(function() {
    'use strict';
    angular.module('app')
        .controller('MainHomeController', MainHomeController);
    MainHomeController.$inject = ['MainHomeModel', '$state'];

    function MainHomeController(MainHomeModel, $state) {

        var Home = this;

        Home.search = ''


        Home.goToHandler = function(state, params) {
            $state.go(state, params);
        }

        // APP SPECIFIC
        Home.searchHandler = function(search) {
            $state.go('main.daumMap', {
                from: 'homeInput'
            })
        }
    }


})();
(function() {
    'use strict';

    angular.module('app')
        .factory('MainHomeModel', MainHomeModel);

    function MainHomeModel() {

        var model = {

        };
        return model;
    }
})();
(function() {
    'use strict';
    angular.module('app')
        .controller('ScheduleController', ScheduleController);

    ScheduleController.$inject = ['DetailModel', 'ScheduleModel', 'Places', 'Bookings', 'Message',
        '$scope', '$ionicModal', '$q', '$stateParams'
    ];

    function ScheduleController(DetailModel, ScheduleModel, Places, Bookings, Message,
        $scope, $ionicModal, $q, $stateParams) {

        var Schedule = this;
        Schedule.Model = ScheduleModel;
        ScheduleModel.current = DetailModel.current;
        var interval = 30;


        //------------------------
        //  Select Reserve Slot Logic
        //------------------------
        Schedule.selectSlotHandler = function(reserveSlot, index) {
            ScheduleModel.selectedSlot = reserveSlot;
            ScheduleModel.selectedIndex = index;

            if (reserveSlot.bookingCount >= DetailModel.current.employee) {
                Message.popUp.alert.default(
                    '예약불가 알림',
                    '예약이 꽉 차있는 시간입니다.'
                );
                return false;
            }
            Schedule.modal.show();
            ScheduleModel.form.datetime = reserveSlot.toDate();
        };

        Schedule.isSelectedSlot = function(reserveSlot) {
            var selectedHourString = ScheduleModel.selectedSlot.get && ScheduleModel.selectedSlot.get('hour');
            var selectedMinuteString = ScheduleModel.selectedSlot.get && ScheduleModel.selectedSlot.get('minute');
            var selectedTimeString = selectedHourString + ':' + selectedMinuteString;
            var reserveSlotHourString = reserveSlot.get && reserveSlot.get('hour');
            var reserveSlotMinuteString = reserveSlot.get && reserveSlot.get('minute');
            var reserveSlotTimeString = reserveSlotHourString + ':' + reserveSlotMinuteString;
            return selectedTimeString === reserveSlotTimeString;
        };

        Schedule.isAvailableSlot = function(reserveSlot) {
            if (reserveSlot.bookingCount != null && DetailModel.current.employee != null) {
                return Number(DetailModel.current.employee) > reserveSlot.bookingCount;
            } else {
                return true;
            }
        };

        //------------------------
        // Logic inside Modal.
        //------------------------
        Schedule.selectProductHandler = function(product) {
            ScheduleModel.form.products = [{
                product: product
            }];
        };
        Schedule.isSelectedProduct = function(product) {
            return ((ScheduleModel.form.products && ScheduleModel.form.products[0] && ScheduleModel.form.products[0].product.id) === product.id);
        };

        Schedule.closeModalHandler = function() {
            Bookings.getBookingsDateBetween({
                placeId: $stateParams.id,
                from: moment($stateParams.selectedDate).clone().toDate().getTime(),
                to: moment($stateParams.selectedDate).clone().add(1, 'days').toDate().getTime()
            }).$promise
                .then(function success(data) {
                    // update viewSlots
                    ScheduleModel.viewSlots = generateReserveMomentSlots($stateParams.selectedDate, DetailModel.current.openingHours, 30, true);
                    updateSlotsWithBookings(data);
                    angular.copy({}, ScheduleModel.form);
                    Schedule.modal.hide();
                });
        }
        Schedule.bookingHandler = function() {
            ScheduleModel.form.place = $stateParams.id;
            // Validation
            if (ScheduleModel.form.products[0] == null) {
                return reserveErrorHelper('서비스란');
            } else if (ScheduleModel.form.userKoreanName == null) {
                return reserveErrorHelper('이름란');
            } else if (ScheduleModel.form.userPhoneNumber == null) {
                return reserveErrorHelper('연락처란');
            }

            Message.loading.default();

            Bookings.getBookingsDateBetween({
                placeId: $stateParams.id,
                from: moment($stateParams.selectedDate).clone().toDate().getTime(),
                to: moment($stateParams.selectedDate).clone().add(1, 'days').toDate().getTime()
            }).$promise.then(function success(data) {
                    // update viewSlots
                    ScheduleModel.viewSlots = generateReserveMomentSlots($stateParams.selectedDate, DetailModel.current.openingHours, 30, true);
                    updateSlotsWithBookings(data);

                    // booking availabilty logic
                    var index = ScheduleModel.selectedIndex;
                    var duration = ScheduleModel.form.products[0].product.duration
                    var numberOfSlots = Math.ceil(duration / interval);
                    for (var i = index; i < index + numberOfSlots; i++) {
                        // service crashes with other times
                        var bookingCounts = ScheduleModel.viewSlots[i].bookingCount ? ScheduleModel.viewSlots[i].bookingCount : 0;
                        if (bookingCounts >= Number(DetailModel.current.employee)) {
                            Message.loading.hide();
                            Message.popUp.alert.default(
                                '예약 불가 안내',
                                '고르신 서비스의 시간이 다음 예약시간과 겹치게 되어 예약이 불가합니다.'
                            );
                            return false;
                        }
                        // service goes out of business hours
                        if (index + numberOfSlots > ScheduleModel.viewSlots.length) {
                            Message.loading.hide();
                            Message.popUp.alert.default(
                                '예약 불가 안내',
                                '고르신 서비스의 시간이 영업 종료시간을 넘기어 예약이 불가합니다.'
                            );
                            return false;
                        }
                    }

                    // make reservation.
                    Bookings.createBooking({}, Schedule.Model.form).$promise
                        .then(function success(data) {
                            Message.loading.hide();
                            Message.popUp.alert.default(
                                '예약 완료 알림',
                                '예약이 완료 되었습니다.'
                            ).then(function(response) {
                                Schedule.closeModalHandler();
                            })
                            console.log(data);
                        }, function err(error) {
                            console.log(error);
                        });
                },
                function err(error) {
                    console.log(error);
                });

        }


        $scope.$on('$ionicView.beforeEnter', function() {

            var openingHours = DetailModel.current.openingHours;
            ScheduleModel.viewSlots = generateReserveMomentSlots($stateParams.selectedDate, openingHours, 30, true);
            Bookings.getBookingsDateBetween({
                placeId: $stateParams.id,
                from: moment($stateParams.selectedDate).clone().toDate().getTime(),
                to: moment($stateParams.selectedDate).clone().add(1, 'days').toDate().getTime()
            }).$promise
                .then(function success(bookingsWrapper) {
                    console.log(bookingsWrapper);
                    updateSlotsWithBookings(bookingsWrapper);
                }, function err(error) {
                    console.log(error);
                });

        });

        $scope.$on('$ionicView.afterEnter', function() {
            // Set Modal
            $ionicModal.fromTemplateUrl('state/schedule/reserveModal.html', {
                scope: $scope,
                animation: 'slide-in-up'
            })
                .then(function(modal) {
                    Schedule.modal = modal;
                });
        });


        //------------------------
        // HELPER FUNCTIONS
        //------------------------

        function generateReserveMomentSlots(selectedDateString, openingHoursArray, interval, ableToBookAtEndTimeBool) {
            // get day of reservedDate, in UTC+9
            var reserveMoment = moment(selectedDateString).set({
                hour: 0,
                minute: 0,
                second: 0
            });
            // get day of selected date
            var dayOfWeek = reserveMoment.day();
            // Get opening hours of that day
            //{start: '07:00', end: '20:00'}
            var hoursObj = openingHoursArray[dayOfWeek];

            // Convert strings to date object.
            var startTimeArray = hoursObj.start.split(':');
            var endTimeArray = hoursObj.end.split(':');

            var startHour = startTimeArray[0];
            var startMinute = startTimeArray[1];
            var endHour = endTimeArray[0];
            var endMinute = endTimeArray[1];

            var startInMinutes = Number(startHour) * 60 + Number(startMinute)
            var endInMinutes = ableToBookAtEndTimeBool ? Number(endHour) * 60 + Number(endMinute) + interval :
                Number(endHour) * 60 + Number(endMinute)

            var arrayOfSlotsInMinutes = _.range(startInMinutes, endInMinutes, interval)

            var arrayOfSlotsInMoment = [];
            angular.forEach(arrayOfSlotsInMinutes, function(minutes, i, self) {
                var reserveMomentCopy = reserveMoment.clone();
                var slot = reserveMomentCopy.set({
                    minute: minutes,
                    second: 0
                })
                arrayOfSlotsInMoment.push(slot);
            })
            // console.log(arrayOfSlotsInMoment);
            return arrayOfSlotsInMoment;
        }

        function updateSlotsWithBookings(bookingsWrapper) {
            var viewSlots = ScheduleModel.viewSlots;
            var bookings = ScheduleModel.bookings = bookingsWrapper.bookings;
            var employee = DetailModel.current.employee;
            // var interval = 30;

            angular.forEach(bookings, function(booking, index, self) {
                // get beginning time(inclusive)
                var begBookingMoment = moment.utc(booking.datetime).local()
                    .add(1, 'seconds');
                var duration = booking.products[0].product && booking.products[0].product.duration;
                // if begTime is between reserveSlot
                // for each viewslots
                for (var i = 0; i < viewSlots.length; i++) {
                    if (i < viewSlots.length - 1) {
                        var viewSlotEnd = viewSlots[i + 1];
                        // if index is the last one.
                    } else if (i === viewSlots.length - 1) {
                        var viewSlotEnd = viewSlots[i].clone().add(interval, 'minutes')
                    }

                    // if beginning of booking time is between reserveSlot
                    if (begBookingMoment.isBetween(viewSlots[i], viewSlotEnd)) {
                        // get number of slots to increament booking count;
                        var numberOfSlotsTaken = Math.ceil(Number(duration) / Number(interval));
                        // increment affected slots bookingCount;
                        for (var j = 0; j < numberOfSlotsTaken; j++) {
                            if (!viewSlots[i + j].bookingCount) {
                                viewSlots[i + j].bookingCount = 1;
                            } else {
                                viewSlots[i + j].bookingCount += 1;
                            }
                        }
                        break;
                    }
                }
            });
        }

        //==========================================================================
        //              Check reserve inputs
        //==========================================================================
        function reserveErrorHelper(korean) {
            Message.popUp.alert.default(
                korean + '이 비었습니다.',
                korean + '을 입력/골라 주세요.'
            )
        }





    }


})();

(function() {
    'use strict';
    angular.module('app')
        .factory('ScheduleModel', ScheduleModel);

    function ScheduleModel() {

        var model = {
            current: {
                openingHours: [{
                    start: '00:00',
                    end: '00:00'
                }, {
                    start: '07:00',
                    end: '20:00'
                }, {
                    start: '07:00',
                    end: '20:00'
                }, {
                    start: '07:00',
                    end: '20:00'
                }, {
                    start: '07:00',
                    end: '20:00'
                }, {
                    start: '09:00',
                    end: '22:00'
                }, {
                    start: '09:00',
                    end: '22:00'
                }]
            },
            selectedSlot: {
                //moment object
            },
            viewSlots: ['moment', 'moment', 'moment'],
            bookings: [{
                datetime: 'datetime',
                products: [{
                    duration: "30"
                }]
            }],

            form: {
                products: [''],
                userKoreanName: null,
                userPhoneNumber: null,
                datetime: new Date(),
                place: 'placeId'
            }

        };

        return model;

    }


})();
(function() {
    'use strict';

    angular.module('app')
        .controller('ShowController', ShowController);

    ShowController.$inject = ['ShowModel', 'Posts', '$state', '$ionicModal', '$scope', 'ShowListModel',
        '$cordovaCamera', 'Message', '$timeout', '$window', '$cordovaFile'
    ];

    function ShowController(ShowModel, Posts, $state, $ionicModal, $scope, ShowListModel,
        $cordovaCamera, Message, $timeout, $window, $cordovaFile
    ) {

        var Show = this;

        $ionicModal.fromTemplateUrl('state/show/showModal.html', {
            scope: $scope,
            animation: 'slide-in-up'
        }).then(function(modal) {
            Show.modal = modal;
        });

        Show.modalHideHandler = function() {
            Show.writeImageSrc = null;
            Show.writeTitle = null;
            Show.writeContent = null;
            Show.modal.hide();
        };

        Show.modalShowHandler = function() {
            Show.modal.show();
        };

        Show.goToSavedPostListHandler = function() {
            $state.go('main.show.savedList');
        };

        //------------------------
        //  Write post logic
        //------------------------
        Show.showWriteImage = function() {
            return Show.writeImageSrc != null;
        };

        Show.getPictureHandler = function(sourceType) {

            // photoLibrary: 0,
            // camera: 1
            // try {
            //     $cordovaCamera.cleanup();
            // } catch (err) {
            //     console.log(err);
            // }

            if (sourceType === undefined) {
                sourceType = 1;
            }

            console.log(sourceType);
            var options = {
                allowEdit: true,
                quality: 50,
                // destinationType: Camera.DestinationType.DATA_URL,
                destinationType: Camera.DestinationType.FILE_URI,
                encodingType: Camera.EncodingType.JPEG, // PNG do not work
                correctOrientation: true,
                targetWidth: 500,
                mediaType: Camera.MediaType.PICTURE,
                // saveToPhotoAlbum: true,
                cameraDirection: Camera.Direction.BACK, // FRONT do not work
                sourceType: sourceType
            };

            $cordovaCamera.getPicture(options)
                .then(function success(imageUrl) {
                    Show.writeImageFile = imageUrl;

                    var name = imageUrl.substr(imageUrl.lastIndexOf('/') + 1);
                    var namePath = imageUrl.substr(0, imageUrl.lastIndexOf('/') + 1);

                    $cordovaFile.readAsDataURL(namePath, name)
                        .then(function(dataUri) {
                            console.log(dataUri);
                            Show.writeImageSrc = dataUri;
                        }, function(error) {
                            console.log(error);
                        })

                }, function error(err) {
                    console.log(err);
                });

        };


        Show.postHandler = function() {
            Message.loading.default();

            var postWithFile = {
                category: 'SHOW-POST',
                title: Show.writeTitle,
                content: Show.writeContent,
                file: Show.writeImageFile
            };

            Posts.createPostWithImage({}, postWithFile).$promise
                .then(function success() {
                    Show.writeTitle = '';
                    Show.writeContent = '';
                    Show.writeImageSrc = null;
                    Show.writeImageFile = '';
                    Message.loading.hide();
                    Message.message.success('포스트가 만들어졌습니다.');
                    Show.modal.hide();
                    $timeout(function() {
                        $state.go('main.show.list', {}, {
                            reload: true
                        });
                    }, 1500);
                }, function err(error) {
                    console.log(error);
                    Message.loading.hide();
                    Message.message.error('다시 시도해주세요.');
                }, function progress(prog) {
                    console.dir(prog);
                });
        };



        // END

    }

})();
(function() {
    'use strict';

    angular.module('app')
        .factory('ShowModel', ShowModel);

    // ShowModel.$inject = [];

    function ShowModel() {

        var model = {

        };
        return model;
    }
})();
